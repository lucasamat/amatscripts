# =========================================================================================================================================
#   __script_name : QTPOSTCQHD.PY
#   __script_description : THIS SCRIPT IS USED TO CREATE QUOTE JSON FOR HADOOP
#   __primary_author__ : SURESH MUNIYANDI, Baji
#   __create_date :
#   Â© BOSTON HARBOR TECHNOLOGY LLC - ALL RIGHTS RESERVED
# ==========================================================================================================================================
import sys
import clr
import System.Net
from System.Text.Encoding import UTF8
from System import Convert
from System.Net import HttpWebRequest, NetworkCredential
from System.Net import *
from System.Net import CookieContainer
from System.Net import Cookie
from System.Net import WebRequest
from System.Net import HttpWebResponse
from System import Uri
clr.AddReference("System.Net")
from System.Net import CookieContainer, NetworkCredential, Mail
from System.Net.Mail import SmtpClient, MailAddress, Attachment, MailMessage

try:

	SAQIEN = 'SAQIEN_INBOUND'
	SAQIEN_DRP = SqlHelper.GetFirst("sp_executesql @T=N'IF EXISTS (SELECT ''X'' FROM SYS.OBJECTS WHERE NAME= ''"+str(SAQIEN)+"'' ) BEGIN DROP TABLE "+str(SAQIEN)+" END  ' ")  

	Jsonquery = SqlHelper.GetFirst("select getdate() as date,DATEADD(HOUR,-2,getdate()) as filter  ")

	Quoteinfoquery = SqlHelper.GetList("SELECT  Quote_id,QTEREV_ID FROM SAQTMT(NOLOCK) WHERE CPQTABLEENTRYDATEADDED >'"+str(Jsonquery.filter)+"' OR CpqTableEntryDateModified > '"+str(Jsonquery.filter)+"' union select  Quote_id,QTEREV_ID from SAQTMT where isnull(hadoop_flag,'False') = 'False' UNION SELECT  Quote_id,QTEREV_ID FROM SAQTRV(NOLOCK) WHERE CPQTABLEENTRYDATEADDED >'"+str(Jsonquery.filter)+"' OR CpqTableEntryDateModified > '"+str(Jsonquery.filter)+"' UNION SELECT  Quote_id,QTEREV_ID FROM SAQTIP(NOLOCK) WHERE CPQTABLEENTRYDATEADDED >'"+str(Jsonquery.filter)+"' OR CpqTableEntryDateModified > '"+str(Jsonquery.filter)+"' UNION SELECT  Quote_id,QTEREV_ID FROM SAQTBP(NOLOCK) WHERE CPQTABLEENTRYDATEADDED >'"+str(Jsonquery.filter)+"' OR CpqTableEntryDateModified > '"+str(Jsonquery.filter)+"' UNION SELECT  Quote_id,QTEREV_ID FROM SAQDOC(NOLOCK) WHERE CPQTABLEENTRYDATEADDED >'"+str(Jsonquery.filter)+"' OR CpqTableEntryDateModified > '"+str(Jsonquery.filter)+"' UNION SELECT  Quote_id,QTEREV_ID FROM SAQITM(NOLOCK) WHERE CPQTABLEENTRYDATEADDED >'"+str(Jsonquery.filter)+"' OR CpqTableEntryDateModified > '"+str(Jsonquery.filter)+"' UNION SELECT  Quote_id,QTEREV_ID FROM SAQICO(NOLOCK) WHERE CPQTABLEENTRYDATEADDED >'"+str(Jsonquery.filter)+"' OR CpqTableEntryDateModified > '"+str(Jsonquery.filter)+"' UNION SELECT  Quote_id,QTEREV_ID FROM SAQICA(NOLOCK) WHERE CPQTABLEENTRYDATEADDED >'"+str(Jsonquery.filter)+"' OR CpqTableEntryDateModified > '"+str(Jsonquery.filter)+"' UNION SELECT  Quote_id,QTEREV_ID FROM SAQIFP(NOLOCK) WHERE CPQTABLEENTRYDATEADDED >'"+str(Jsonquery.filter)+"' OR CpqTableEntryDateModified > '"+str(Jsonquery.filter)+"' UNION SELECT  Quote_id,QTEREV_ID FROM SAQIBP(NOLOCK) WHERE CPQTABLEENTRYDATEADDED >'"+str(Jsonquery.filter)+"' OR CpqTableEntryDateModified > '"+str(Jsonquery.filter)+"'  UNION SELECT  Quote_id,QTEREV_ID FROM SAQIEN(NOLOCK) WHERE CPQTABLEENTRYDATEADDED >'"+str(Jsonquery.filter)+"' OR CpqTableEntryDateModified > '"+str(Jsonquery.filter)+"'")

	Parameter = SqlHelper.GetFirst("SELECT QUERY_CRITERIA_1 FROM SYDBQS (NOLOCK) WHERE QUERY_NAME = 'SELECT' ")
	Parameter1 = SqlHelper.GetFirst("SELECT QUERY_CRITERIA_1 FROM SYDBQS (NOLOCK) WHERE QUERY_NAME = 'UPD' ")

	Qtinfoquery = SqlHelper.GetFirst("sp_executesql @T=N'UPDATE  SAQTMT SET HADOOP_FLAG = ''FALSE'' WHERE CPQTABLEENTRYDATEADDED >''"+str(Jsonquery.filter)+"'' '")

	for data in Quoteinfoquery:
		
		sessionid = SqlHelper.GetFirst("SELECT GETDATE() AS A")
		timestamp_sessionid = "'" + str(sessionid.A) + "'"		
		
		Qt_ID = str(data.Quote_id)
		Revision_ID = str(data.QTEREV_ID)

		SAQTMT_QUERY = SqlHelper.GetFirst("	SELECT CASE WHEN ISNULL(RESULT,'') = '' THEN '' ELSE RESULT END AS RESULT FROM (SELECT replace ('\"SAQTMT\": ['+STUFF((SELECT ','+ JSON FROM (SELECT DISTINCT '{\"ACCOUNT_ID\" : \"'+ACCOUNT_ID+'\",\"ADVANCED_SHIPPING_EMAIL\" : \"'+ADVANCED_SHIPPING_EMAIL+'\",\"C4C_QUOTE_ID\" : \"'+C4C_QUOTE_ID+'\",\"CANCELLATION_PERIOD\" : \"'+CANCELLATION_PERIOD+'\",\"CONTRACT_VALID_FROM\" : \"'+CONTRACT_VALID_FROM+'\",\"CONTRACT_VALID_TO\" : \"'+CONTRACT_VALID_TO+'\",\"CRM_CONTRACT_ID\" : \"'+CRM_CONTRACT_ID+'\",\"CUSTOMER_NOTES\" : \"'+CUSTOMER_NOTES+'\",\"GLOBAL_CURRENCY\" : \"'+GLOBAL_CURRENCY+'\",\"NET_VALUE\" : \"'+NET_VALUE+'\",\"QUOTE_APPROVE_DATE\" : \"'+QUOTE_APPROVE_DATE+'\",\"QUOTE_CREATED_DATE\" : \"'+QUOTE_CREATED_DATE+'\",\"QUOTE_CURRENCY\" : \"'+QUOTE_CURRENCY+'\",\"QUOTE_EXPIRE_DATE\" : \"'+QUOTE_EXPIRE_DATE+'\",\"QUOTE_ID\" : \"'+QUOTE_ID+'\",\"QUOTE_LEVEL\" : \"'+QUOTE_LEVEL+'\",\"QUOTE_NAME\" : \"'+QUOTE_NAME+'\",\"QUOTE_STATUS\" : \"'+QUOTE_STATUS+'\",\"QUOTE_TYPE\" : \"'+QUOTE_TYPE+'\",\"REASONFOR_REJECTION\" : \"'+REASONFOR_REJECTION+'\",\"SALE_TYPE\" : \"'+SALE_TYPE+'\",\"SOURCE_CONTRACT_ID\" : \"'+SOURCE_CONTRACT_ID+'\",\"POES\" : \"'+POES+'\",\"OPPORTUNITY_ID\" : \"'+OPPORTUNITY_ID+'\",\"OPPORTUNITY_NAME\" : \"'+OPPORTUNITY_NAME+'\",\"QTEREV_ID\" : \"'+QTEREV_ID+'\",\"Timestamp\" : \"'+SESSION_ID+'\"}' AS JSON from (SELECT DISTINCT  ISNULL(SAQTMT.ACCOUNT_ID,'') AS	ACCOUNT_ID,ISNULL(SAQTRV.ADVANCED_SHIPPING_EMAIL,'') AS	ADVANCED_SHIPPING_EMAIL,ISNULL(SAQTMT.C4C_QUOTE_ID,'')	AS	C4C_QUOTE_ID,ISNULL(SAQTRV.CANCELLATION_PERIOD,'')	AS	CANCELLATION_PERIOD,ISNULL(CONVERT(VARCHAR(11),SAQTMT.CONTRACT_VALID_FROM,101),'')	AS	CONTRACT_VALID_FROM,ISNULL(CONVERT(VARCHAR(11),SAQTMT.CONTRACT_VALID_TO,101),'')	AS	CONTRACT_VALID_TO,ISNULL(SAQTMT.CRM_CONTRACT_ID,'')	AS	CRM_CONTRACT_ID,ISNULL(SAQTMT.CUSTOMER_NOTES,'')	AS	CUSTOMER_NOTES,ISNULL(SAQTMT.GLOBAL_CURRENCY,'')	AS	GLOBAL_CURRENCY,ISNULL(CONVERT(VARCHAR,SAQTMT.NET_VALUE),'')	AS	NET_VALUE,ISNULL(CONVERT(VARCHAR(11),SAQTMT.QUOTE_APPROVE_DATE,101),'') AS	QUOTE_APPROVE_DATE,ISNULL(CONVERT(VARCHAR(11),SAQTMT.QUOTE_CREATED_DATE,101),'') AS	QUOTE_CREATED_DATE,ISNULL(SAQTMT.QUOTE_CURRENCY,'')	AS	QUOTE_CURRENCY,ISNULL(CONVERT(VARCHAR(11),SAQTMT.QUOTE_EXPIRE_DATE,101),'')	AS	QUOTE_EXPIRE_DATE,ISNULL(SAQTMT.QUOTE_ID,'')	AS	QUOTE_ID,ISNULL(SAQTMT.QUOTE_LEVEL,'')	AS	QUOTE_LEVEL,ISNULL(SAQTMT.QUOTE_NAME,'')	AS	QUOTE_NAME,ISNULL(SAQTMT.QUOTE_STATUS,'')	AS	QUOTE_STATUS,ISNULL(SAQTMT.QUOTE_TYPE,'')	AS	QUOTE_TYPE,ISNULL(SAQTMT.REASONFOR_REJECTION,'') AS	REASONFOR_REJECTION,ISNULL(SAQTMT.SALE_TYPE,'')	AS	SALE_TYPE,ISNULL(SAQTMT.SOURCE_CONTRACT_ID,'')	AS	SOURCE_CONTRACT_ID,ISNULL(CONVERT(VARCHAR,SAQTMT.POES),'')	AS	POES,ISNULL(SAOPQT.OPPORTUNITY_ID,'')	AS	OPPORTUNITY_ID,ISNULL(SAOPQT.OPPORTUNITY_NAME,'')	AS	OPPORTUNITY_NAME,ISNULL(SAQTMT.QTEREV_ID,'') AS	QTEREV_ID,"+str(timestamp_sessionid)+" as SESSION_ID FROM SAQTMT (NOLOCK) LEFT JOIN SAQTRV(NOLOCK) ON SAQTMT.QUOTE_ID = SAQTRV.QUOTE_ID LEFT JOIN SAOPQT(NOLOCK) ON SAQTMT.QUOTE_ID = SAOPQT.QUOTE_ID WHERE SAQTMT.QUOTE_ID = '"+str(Qt_ID)+"' AND SAQTMT.QTEREV_ID = '"+str(Revision_ID)+"' ) t 	) A FOR XML PATH ('')  ), 1, 1, '')+']','amp;#','#') AS RESULT)A "
			) 
		#SAQTRV
		SAQTRV_QUERY = SqlHelper.GetFirst("SELECT CASE WHEN ISNULL(RESULT,'') = '' THEN '' ELSE RESULT END AS RESULT FROM (SELECT replace ('\"SAQTRV\": ['+STUFF((SELECT ','+ JSON FROM (SELECT DISTINCT '{\"ACCOUNT_ID\" : \"'+ACCOUNT_ID+'\",\"ACCOUNT_PRICING_PROCEDURE\" : \"'+ACCOUNT_PRICING_PROCEDURE+'\",\"ACCTAXCAT_ID\" : \"'+ACCTAXCAT_ID+'\",\"ACCTAXCLA_ID\" : \"'+ACCTAXCLA_ID+'\",\"COUNTRY\" : \"'+COUNTRY+'\",\"DISTRIBUTIONCHANNEL_ID\" : \"'+DISTRIBUTIONCHANNEL_ID+'\",\"DIVISION_ID\" : \"'+DIVISION_ID+'\",\"DOCUMENT_PRICING_PROCEDURE\" : \"'+DOCUMENT_PRICING_PROCEDURE+'\",\"EXCHANGE_RATE\" : \"'+EXCHANGE_RATE+'\"		,\"EXCHANGE_RATE_DATE\" : \"'+EXCHANGE_RATE_DATE+'\",\"EXCHANGE_RATE_TYPE\" : \"'+EXCHANGE_RATE_TYPE+'\",\"GLOBAL_CURRENCY\" : \"'+GLOBAL_CURRENCY+'\",\"PRICINGPROCEDURE_ID\" : \"'+PRICINGPROCEDURE_ID+'\",\"QUOTE_CURRENCY\" : \"'+QUOTE_CURRENCY+'\",\"QUOTE_ID\" : \"'+QUOTE_ID+'\",\"REGION\" : \"'+REGION+'\",\"SALESOFFICE_ID\" : \"'+SALESOFFICE_ID+'\",\"SORG_CURRENCY\" : \"'+SORG_CURRENCY+'\",\"SALESORG_ID\" : \"'+SALESORG_ID+'\",\"BLUEBOOK\" : \"'+BLUEBOOK+'\",\"DOCTYP_ID\" : \"'+DOCTYP_ID+'\",\"QTEREV_ID\" : \"'+QTEREV_ID+'\",\"REVISION_NAME\" : \"'+REVISION_NAME+'\",\"REVISION_DESCRIPTION\" : \"'+REVISION_DESCRIPTION+'\",\"REVISION_STATUS\" : \"'+REVISION_STATUS+'\",\"REV_CREATE_DATE\" : \"'+REV_CREATE_DATE+'\",\"REV_APPROVE_DATE\" : \"'+REV_APPROVE_DATE+'\",\"REV_EXPIRE_DATE\" : \"'+REV_EXPIRE_DATE+'\",\"ACTIVE\" : \"'+ACTIVE+'\",\"CONTRACT_VALID_FROM\" : \"'+CONTRACT_VALID_FROM+'\",\"CONTRACT_VALID_TO\" : \"'+CONTRACT_VALID_TO+'\",\"INCOTERM_ID\" : \"'+INCOTERM_ID+'\",\"INCOTERM_NAME\" : \"'+INCOTERM_NAME+'\",\"PAYMENTTERM_ID\" : \"'+PAYMENTTERM_ID+'\",\"PAYMENTTERM_NAME\" : \"'+PAYMENTTERM_NAME+'\",\"PAYMENTTERM_DAYS\" : \"'+PAYMENTTERM_DAYS+'\"}' AS JSON from (SELECT DISTINCT  ISNULL(SAQTMT.ACCOUNT_ID,'')	AS	ACCOUNT_ID,ISNULL(SAQTRV.ACCOUNT_PRICING_PROCEDURE,'')	AS	ACCOUNT_PRICING_PROCEDURE,ISNULL(SAQTRV.ACCTAXCAT_ID,'') AS	ACCTAXCAT_ID,ISNULL(SAQTRV.ACCTAXCLA_ID,'')	AS	ACCTAXCLA_ID,ISNULL(SAQTRV.COUNTRY,'')	AS	COUNTRY,ISNULL(SAQTRV.DISTRIBUTIONCHANNEL_ID,'')	AS	DISTRIBUTIONCHANNEL_ID,ISNULL(SAQTRV.DIVISION_ID,'') AS	DIVISION_ID,ISNULL(SAQTRV.DOCUMENT_PRICING_PROCEDURE,'')	AS	DOCUMENT_PRICING_PROCEDURE,ISNULL(CONVERT(VARCHAR,SAQTRV.EXCHANGE_RATE),'')  AS	EXCHANGE_RATE,ISNULL(CONVERT(VARCHAR(11),SAQTRV.EXCHANGE_RATE_DATE,101),'')	AS	EXCHANGE_RATE_DATE,ISNULL(SAQTRV.EXCHANGE_RATE_TYPE,'')	AS	EXCHANGE_RATE_TYPE,ISNULL(SAQTRV.GLOBAL_CURRENCY,'') AS	GLOBAL_CURRENCY,ISNULL(SAQTRV.PRICINGPROCEDURE_ID,'')	AS	PRICINGPROCEDURE_ID,ISNULL(SAQTMT.QUOTE_CURRENCY,'')	AS	QUOTE_CURRENCY,ISNULL(SAQTRV.QUOTE_ID,'')	AS	QUOTE_ID,ISNULL(SAQTRV.REGION,'')	AS	REGION,ISNULL(SAQTRV.SALESOFFICE_ID,'')	AS	SALESOFFICE_ID,ISNULL(SAQTRV.DOC_CURRENCY,'') AS	SORG_CURRENCY,ISNULL(SAQTRV.SALESORG_ID,'')	AS	SALESORG_ID,ISNULL(CONVERT(VARCHAR,SAQTRV.BLUEBOOK),'')	AS	BLUEBOOK,ISNULL(CONVERT(VARCHAR,SAQTRV.DOCTYP_ID),'')	AS	DOCTYP_ID,ISNULL(CONVERT(VARCHAR,SAQTRV.QTEREV_ID),'')	AS	QTEREV_ID,ISNULL(SAQTRV.REVISION_NAME,'')	AS	REVISION_NAME,ISNULL(SAQTRV.REVISION_DESCRIPTION,'')	AS	REVISION_DESCRIPTION,ISNULL(SAQTRV.REVISION_STATUS,'')	AS	REVISION_STATUS,ISNULL(CONVERT(VARCHAR(11),SAQTRV.REV_CREATE_DATE,101),'')	AS	REV_CREATE_DATE,ISNULL(CONVERT(VARCHAR(11),SAQTRV.REV_APPROVE_DATE,101),'')	AS	REV_APPROVE_DATE,ISNULL(CONVERT(VARCHAR(11),SAQTRV.REV_EXPIRE_DATE,101),'')	AS	REV_EXPIRE_DATE,ISNULL(CONVERT(VARCHAR,SAQTRV.ACTIVE),'')	AS	ACTIVE,ISNULL(CONVERT(VARCHAR(11),SAQTRV.CONTRACT_VALID_FROM,101),'')	AS	CONTRACT_VALID_FROM,ISNULL(CONVERT(VARCHAR(11),SAQTRV.CONTRACT_VALID_TO,101),'')	AS	CONTRACT_VALID_TO,ISNULL(SAQTRV.INCOTERM_ID,'')	AS	INCOTERM_ID,ISNULL(SAQTRV.INCOTERM_NAME,'')	AS	INCOTERM_NAME,ISNULL(SAQTRV.PAYMENTTERM_ID,'')	AS	PAYMENTTERM_ID,ISNULL(SAQTRV.PAYMENTTERM_NAME,'')	AS	PAYMENTTERM_NAME,ISNULL(SAQTRV.PAYMENTTERM_DAYS,'')	AS	PAYMENTTERM_DAYS FROM SAQTRV(NOLOCK) LEFT JOIN SAQTMT(NOLOCK) ON SAQTMT.QUOTE_ID = SAQTRV.QUOTE_ID WHERE SAQTRV.QUOTE_ID = '"+str(Qt_ID)+"' AND SAQTRV.QTEREV_ID = '"+str(Revision_ID)+"') t 	) A FOR XML PATH ('')  ), 1, 1, '')+']','amp;#','#') AS RESULT)A ")
			
		#SAQTIP
		SAQTIP_QUERY = SqlHelper.GetFirst(
				"SELECT CASE WHEN ISNULL(RESULT,'') = '' THEN '' ELSE RESULT END AS RESULT FROM (SELECT replace ('\"SAQTIP\": ['+STUFF((SELECT ','+ JSON FROM (SELECT DISTINCT '{\"ADDRESS\" : \"'+ADDRESS+'\",\"EMAIL\" : \"'+EMAIL+'\",\"IS_MAIN\" : \"'+IS_MAIN+'\",\"PARTY_ID\" : \"'+PARTY_ID+'\",\"PARTY_NAME\" : \"'+PARTY_NAME+'\",\"PARTY_ROLE\" : \"'+PARTY_ROLE+'\",\"PHONE\" : \"'+PHONE+'\",\"QUOTE_ID\" : \"'+QUOTE_ID+'\",\"SALESORG_ID\" : \"'+SALESORG_ID+'\",\"QTEREV_ID\" : \"'+QTEREV_ID+'\"}' AS JSON from (SELECT DISTINCT  ISNULL(ADDRESS,'')	AS	ADDRESS,ISNULL(EMAIL,'') AS	EMAIL,ISNULL(CONVERT(VARCHAR,IS_MAIN),'')	AS	IS_MAIN,ISNULL(PARTY_ID,'')	AS	PARTY_ID,ISNULL(PARTY_NAME,'')	AS	PARTY_NAME,ISNULL(PARTY_ROLE,'')	AS	PARTY_ROLE,ISNULL(PHONE,'')	AS	PHONE,ISNULL(QUOTE_ID,'')	AS	QUOTE_ID,ISNULL(SALESORG_ID,'')  AS	SALESORG_ID,ISNULL(QTEREV_ID,'')  AS	QTEREV_ID FROM SAQTIP(NOLOCK) WHERE SAQTIP.QUOTE_ID = '"+str(Qt_ID)+"' AND SAQTIP.QTEREV_ID = '"+str(Revision_ID)+"') t ) A FOR XML PATH ('')  ), 1, 1, '')+']','amp;#','#') AS RESULT)A "
			)

		#SAQTBP
		SAQTBP_QUERY = SqlHelper.GetFirst("SELECT CASE WHEN ISNULL(RESULT,'') = '' THEN '' ELSE RESULT END AS RESULT FROM (SELECT replace ('\"SAQTBP\": ['+STUFF((SELECT ','+ JSON FROM (SELECT DISTINCT '{\"BILLING_DAY\" : \"'+BILLING_DAY+'\",\"BILLING_END_DATE\" : \"'+BILLING_END_DATE+'\",\"BILLING_INTERVAL\" : \"'+BILLING_INTERVAL+'\",\"BILLING_NOTES\" : \"'+BILLING_NOTES+'\",\"BILLING_START_DATE\" : \"'+BILLING_START_DATE+'\",\"BOOKING_METHOD\" : \"'+BOOKING_METHOD+'\",\"IS_CHANGED\" : \"'+IS_CHANGED+'\",\"PO_DATE\" : \"'+PO_DATE+'\",\"PO_NUMBER\" : \"'+PO_NUMBER+'\",\"QUOTE_ID\" : \"'+QUOTE_ID+'\",\"SALESORG_ID\" : \"'+SALESORG_ID+'\",\"SERVICE_AGREEMENT_NUMBER\" : \"'+SERVICE_AGREEMENT_NUMBER+'\"	,\"QTEREV_ID\" : \"'+QTEREV_ID+'\" }' AS JSON from (SELECT DISTINCT ISNULL(CONVERT(VARCHAR,BILLING_DAY),'') AS	BILLING_DAY,ISNULL(CONVERT(VARCHAR(11),BILLING_END_DATE,101),'') AS	BILLING_END_DATE,ISNULL(BILLING_INTERVAL,'') AS	BILLING_INTERVAL,ISNULL(BILLING_NOTES,'') AS BILLING_NOTES,ISNULL(CONVERT(VARCHAR(11),BILLING_START_DATE,101),'') AS	BILLING_START_DATE,ISNULL(BOOKING_METHOD,'') AS	BOOKING_METHOD,ISNULL(CONVERT(VARCHAR,IS_CHANGED),'') AS IS_CHANGED,ISNULL(CONVERT(VARCHAR(11),PO_DATE,101),'') AS PO_DATE,ISNULL(PO_NUMBER,'')  AS	PO_NUMBER ,ISNULL(QUOTE_ID,'') AS	QUOTE_ID,ISNULL(SALESORG_ID,'')  AS	SALESORG_ID,ISNULL(SERVICE_AGREEMENT_NUMBER,'')  AS	SERVICE_AGREEMENT_NUMBER ,ISNULL(QTEREV_ID,'') AS	QTEREV_ID FROM SAQTBP(NOLOCK)  WHERE SAQTBP.QUOTE_ID = '"+str(Qt_ID)+"'  AND SAQTBP.QTEREV_ID = '"+str(Revision_ID)+"') t	) A FOR XML PATH ('')  ), 1, 1, '')+']','amp;#','#') AS RESULT)A ")

		#SAQDOC
		SAQDOC_QUERY = SqlHelper.GetFirst(
				"SELECT CASE WHEN ISNULL(RESULT,'') = '' THEN '' ELSE RESULT END AS RESULT FROM (SELECT replace ('\"SAQDOC\": ['+STUFF((SELECT ','+ JSON FROM (SELECT DISTINCT '{\"DOCUMENT_ID\" : \"'+DOCUMENT_ID+'\",\"DOCUMENT_NAME\" : \"'+DOCUMENT_NAME+'\",\"DOCUMENT_PATH\" : \"'+DOCUMENT_PATH+'\",\"LANGUAGE_ID\" : \"'+LANGUAGE_ID+'\",\"QUOTE_ID\" : \"'+QUOTE_ID+'\",\"STATUS\" : \"'+STATUS+'\",\"QTEREV_ID\" : \"'+QTEREV_ID+'\"}' AS JSON from (SELECT DISTINCT  ISNULL(DOCUMENT_ID,'') AS	DOCUMENT_ID,ISNULL(DOCUMENT_NAME,'') AS	DOCUMENT_NAME,ISNULL(DOCUMENT_PATH,'') AS DOCUMENT_PATH,ISNULL(LANGUAGE_ID,'')	AS	LANGUAGE_ID,ISNULL(QUOTE_ID,'')	AS	QUOTE_ID,ISNULL(STATUS,'')	AS	STATUS,ISNULL(QTEREV_ID,'') AS	QTEREV_ID FROM SAQDOC(NOLOCK)  WHERE SAQDOC.QUOTE_ID = '"+str(Qt_ID)+"' AND SAQDOC.QTEREV_ID = '"+str(Revision_ID)+"' ) t 	) A FOR XML PATH ('')  ), 1, 1, '')+']','amp;#','#') AS RESULT)A "
			)
			
		#SAQITM
		SAQITM_QUERY = SqlHelper.GetFirst(
				"SELECT CASE WHEN ISNULL(RESULT,'') = '' THEN '' ELSE RESULT END AS RESULT FROM (SELECT replace ('\"SAQITM\": ['+STUFF((SELECT ','+ JSON FROM (SELECT DISTINCT '{\"BD_PRICE\" : \"'+BD_PRICE+'\",\"BD_PRICE_MARGIN\" : \"'+BD_PRICE_MARGIN+'\",\"CEILING_PRICE\" : \"'+CEILING_PRICE+'\",\"CEILING_PRICE_MARGIN\" : \"'+CEILING_PRICE_MARGIN+'\",\"CONDITION_TYPE\" : \"'+CONDITION_TYPE+'\",\"CURRENCY\" : \"'+CURRENCY+'\",\"DELIVERY_PRIORITY\" : \"'+DELIVERY_PRIORITY+'\",\"DISCOUNT\" : \"'+DISCOUNT+'\",\"DIVISION_ID\" : \"'+DIVISION_ID+'\",\"EXTENDED_PRICE\" : \"'+EXTENDED_PRICE+'\",\"GLOBAL_CURRENCY\" : \"'+GLOBAL_CURRENCY+'\",\"INTERNAL_NOTES\" : \"'+INTERNAL_NOTES+'\",\"ITEMCATEGORY_ID\" : \"'+ITEMCATEGORY_ID+'\",\"ITEM_NOTES\" : \"'+ITEM_NOTES+'\",\"ITEM_STATUS\" : \"'+ITEM_STATUS+'\",\"ITEM_TYPE\" : \"'+ITEM_TYPE+'\",\"LINE_ITEM_FROM_DATE\" : \"'+LINE_ITEM_FROM_DATE+'\",\"LINE_ITEM_ID\" : \"'+LINE_ITEM_ID+'\",\"LINE_ITEM_TO_DATE\" : \"'+LINE_ITEM_TO_DATE+'\",\"MATERIALGROUP_ID\" : \"'+MATERIALGROUP_ID+'\",\"MATPRIGRP_ID\" : \"'+MATPRIGRP_ID+'\",\"MAX_DELIVER_QTY\" : \"'+MAX_DELIVER_QTY+'\",\"OBJECT_QUANTITY\" : \"'+OBJECT_QUANTITY+'\",\"ONSITE_PURCHASE_COMMIT\" : \"'+ONSITE_PURCHASE_COMMIT+'\",\"PARQTEITM_LINE\" : \"'+PARQTEITM_LINE+'\",\"PLANT_ID\" : \"'+PLANT_ID+'\",\"PRICELIST_ID\" : \"'+PRICELIST_ID+'\",\"PRICINGPROCEDURE_ID\" : \"'+PRICINGPROCEDURE_ID+'\",\"PRICING_STATUS\" : \"'+PRICING_STATUS+'\",\"PO_ITEM\" : \"'+PO_ITEM+'\",\"PO_NOTES\" : \"'+PO_NOTES+'\",\"PO_NUMBER\" : \"'+PO_NUMBER+'\",\"QUANTITY\" : \"'+QUANTITY+'\",\"QUOTE_CURRENCY\" : \"'+QUOTE_CURRENCY+'\",\"QUOTE_ID\" : \"'+QUOTE_ID+'\",\"REASON_FOR_REJECTION\" : \"'+REASON_FOR_REJECTION+'\",\"RELEASED_QUANTITY\" : \"'+RELEASED_QUANTITY+'\",\"REMAINING_QUANTITY\" : \"'+REMAINING_QUANTITY+'\",\"SALES_DISCOUNT_PRICE\" : \"'+SALES_DISCOUNT_PRICE+'\",\"SALES_DISCOUNT_PRICE_MARGIN\" : \"'+SALES_DISCOUNT_PRICE_MARGIN+'\",\"SORG_CURRENCY\" : \"'+SORG_CURRENCY+'\",\"SALESORG_ID\" : \"'+SALESORG_ID+'\",\"SALES_PRICE\" : \"'+SALES_PRICE+'\",\"SERVICE_ID\" : \"'+SERVICE_ID+'\",\"SRVTAXCAT_ID\" : \"'+SRVTAXCAT_ID+'\",\"SRVTAXCLA_ID\" : \"'+SRVTAXCLA_ID+'\",\"TARGET_PRICE\" : \"'+TARGET_PRICE+'\",\"TARGET_PRICE_MARGIN\" : \"'+TARGET_PRICE_MARGIN+'\",\"TAX\" : \"'+TAX+'\",\"TAX_PERCENTAGE\" : \"'+TAX_PERCENTAGE+'\",\"UOM_ID\" : \"'+UOM_ID+'\",\"YEAR_1\" : \"'+YEAR_1+'\",\"YEAR_2\" : \"'+YEAR_2+'\",\"YEAR_3\" : \"'+YEAR_3+'\",\"YEAR_4\" : \"'+YEAR_4+'\",\"YEAR_5\" : \"'+YEAR_5+'\",\"YEAR_OVER_YEAR\" : \"'+YEAR_OVER_YEAR+'\",\"QTEREV_ID\" : \"'+QTEREV_ID+'\",\"BD_PRICE_INGL_CURR\" : \"'+BD_PRICE_INGL_CURR+'\",\"CEILING_PRICE_INGL_CURR\" : \"'+CEILING_PRICE_INGL_CURR+'\",\"DISCOUNT_AMOUNT_INGL_CURR\" : \"'+DISCOUNT_AMOUNT_INGL_CURR+'\",\"ENTPRCIMP_INGL_CURR\" : \"'+ENTPRCIMP_INGL_CURR+'\",\"ITMCATGRP_ID\" : \"'+ITMCATGRP_ID+'\",\"MODEL_PRICE_INGL_CURR\" : \"'+MODEL_PRICE_INGL_CURR+'\",\"NET_PRICE_INGL_CURR\" : \"'+NET_PRICE_INGL_CURR+'\",\"NET_VALUE_INGL_CURR\" : \"'+NET_VALUE_INGL_CURR+'\",\"SLSDIS_PRICE_INGL_CURR\" : \"'+SLSDIS_PRICE_INGL_CURR+'\",\"TARGET_PRICE_INGL_CURR\" : \"'+TARGET_PRICE_INGL_CURR+'\",\"TAX_AMOUNT_INGL_CURR\" : \"'+TAX_AMOUNT_INGL_CURR+'\",\"TOTAL_COST_WOSEEDSTOCK\" : \"'+TOTAL_COST_WOSEEDSTOCK+'\",\"TOTAL_COST_WSEEDSTOCK\" : \"'+TOTAL_COST_WSEEDSTOCK+'\",\"YEAR_1_INGL_CURR\" : \"'+YEAR_1_INGL_CURR+'\",\"YEAR_2_INGL_CURR\" : \"'+YEAR_2_INGL_CURR+'\",\"YEAR_3_INGL_CURR\" : \"'+YEAR_3_INGL_CURR+'\",\"YEAR_4_INGL_CURR\" : \"'+YEAR_4_INGL_CURR+'\",\"YEAR_5_INGL_CURR\" : \"'+YEAR_5_INGL_CURR+'\",\"ENTITLEMENT_COST_IMPACT\" : \"'+ENTITLEMENT_COST_IMPACT+'\",\"ENTITLEMENT_PRICE_IMPACT\" : \"'+ENTITLEMENT_PRICE_IMPACT+'\"}' AS JSON from (SELECT DISTINCT  ISNULL(CONVERT(VARCHAR,BD_PRICE),'')	AS	BD_PRICE,ISNULL(CONVERT(VARCHAR,BD_PRICE_MARGIN),'')	AS	BD_PRICE_MARGIN,ISNULL(CONVERT(VARCHAR,CEILING_PRICE),'')	AS	CEILING_PRICE,ISNULL(CONVERT(VARCHAR,CEILING_PRICE_MARGIN),'') AS CEILING_PRICE_MARGIN,ISNULL(CONDITION_TYPE,'') AS	CONDITION_TYPE,ISNULL(CURRENCY,'') AS CURRENCY,ISNULL(DELIVERY_PRIORITY,'')	AS	DELIVERY_PRIORITY,ISNULL(CONVERT(VARCHAR,DISCOUNT),'') AS DISCOUNT,ISNULL(DIVISION_ID,'') AS DIVISION_ID,ISNULL(CONVERT(VARCHAR,NET_VALUE),'')	AS EXTENDED_PRICE,ISNULL(GLOBAL_CURRENCY,'') AS	GLOBAL_CURRENCY,ISNULL(INTERNAL_NOTES,'') AS INTERNAL_NOTES,ISNULL(ITEMCATEGORY_ID,'') AS ITEMCATEGORY_ID,ISNULL(ITEM_NOTES,'')	AS	ITEM_NOTES,ISNULL(ITEM_STATUS,'') AS ITEM_STATUS,ISNULL(ITEM_TYPE,'') AS ITEM_TYPE,ISNULL(CONVERT(VARCHAR(11),LINE_ITEM_FROM_DATE,101),'') AS LINE_ITEM_FROM_DATE,ISNULL(LINE_ITEM_ID,'') AS	LINE_ITEM_ID,ISNULL(CONVERT(VARCHAR(11),LINE_ITEM_TO_DATE,101),'')	AS	LINE_ITEM_TO_DATE,ISNULL(MATERIALGROUP_ID,'')	AS	MATERIALGROUP_ID,ISNULL(MATPRIGRP_ID,'') AS	MATPRIGRP_ID,ISNULL(CONVERT(VARCHAR,MAX_DELIVER_QTY),'') AS	MAX_DELIVER_QTY,ISNULL(CONVERT(VARCHAR,OBJECT_QUANTITY),'')	AS	OBJECT_QUANTITY,ISNULL(ONSITE_PURCHASE_COMMIT,'') AS	ONSITE_PURCHASE_COMMIT,ISNULL(PARQTEITM_LINE,'') AS	PARQTEITM_LINE,ISNULL(PLANT_ID,'') AS PLANT_ID,ISNULL(PRICELIST_ID,'')	AS	PRICELIST_ID,ISNULL(PRICINGPROCEDURE_ID,'')	AS	PRICINGPROCEDURE_ID,ISNULL(PRICING_STATUS,'')	AS	PRICING_STATUS,ISNULL(PO_ITEM,'') AS PO_ITEM,ISNULL(PO_NOTES,'') AS	PO_NOTES,ISNULL(PO_NUMBER,'') AS PO_NUMBER,ISNULL(CONVERT(VARCHAR,QUANTITY),'')	AS	QUANTITY,ISNULL(QUOTE_CURRENCY,'') AS QUOTE_CURRENCY,ISNULL(QUOTE_ID,'') AS QUOTE_ID,ISNULL(REASON_FOR_REJECTION,'') AS REASON_FOR_REJECTION,ISNULL(CONVERT(VARCHAR,RELEASED_QUANTITY),'') AS	RELEASED_QUANTITY,ISNULL(CONVERT(VARCHAR,REMAINING_QUANTITY),'') AS REMAINING_QUANTITY,ISNULL(CONVERT(VARCHAR,SALES_DISCOUNT_PRICE),'') AS SALES_DISCOUNT_PRICE,ISNULL(CONVERT(VARCHAR,SALES_DISCOUNT_PRICE_MARGIN_RECORD_ID),'')	AS SALES_DISCOUNT_PRICE_MARGIN,ISNULL(DOC_CURRENCY,'') AS SORG_CURRENCY,ISNULL(SALESORG_ID,'') AS SALESORG_ID,ISNULL(CONVERT(VARCHAR,NET_PRICE),'') AS SALES_PRICE,ISNULL(SERVICE_ID,'') AS	SERVICE_ID,ISNULL(SRVTAXCAT_ID,'') AS SRVTAXCAT_ID,ISNULL(SRVTAXCLA_ID,'') AS SRVTAXCLA_ID,ISNULL(CONVERT(VARCHAR,TARGET_PRICE),'') AS	TARGET_PRICE,ISNULL(CONVERT(VARCHAR,TARGET_PRICE_MARGIN),'') AS	TARGET_PRICE_MARGIN,ISNULL(CONVERT(VARCHAR,TAX_AMOUNT),'')	AS TAX,ISNULL(CONVERT(VARCHAR,TAX_PERCENTAGE),'') AS	TAX_PERCENTAGE,ISNULL(UOM_ID,'') AS UOM_ID,ISNULL(CONVERT(VARCHAR,YEAR_1),'') AS YEAR_1,ISNULL(CONVERT(VARCHAR,YEAR_2),'') AS YEAR_2,ISNULL(CONVERT(VARCHAR,YEAR_3),'') AS YEAR_3,ISNULL(CONVERT(VARCHAR,YEAR_4),'') AS YEAR_4,ISNULL(CONVERT(VARCHAR,YEAR_5),'') AS YEAR_5,ISNULL(CONVERT(VARCHAR,YEAR_OVER_YEAR),'') AS YEAR_OVER_YEAR,ISNULL(QTEREV_ID,'') AS	QTEREV_ID,ISNULL(CONVERT(VARCHAR,BD_PRICE_INGL_CURR),'') AS	BD_PRICE_INGL_CURR,ISNULL(CONVERT(VARCHAR,CEILING_PRICE_INGL_CURR),'')	AS	CEILING_PRICE_INGL_CURR,ISNULL(CONVERT(VARCHAR,DISCOUNT_AMOUNT_INGL_CURR),'') AS DISCOUNT_AMOUNT_INGL_CURR,ISNULL(CONVERT(VARCHAR,ENTPRCIMP_INGL_CURR),'') AS ENTPRCIMP_INGL_CURR,ISNULL(ITMCATGRP_ID,'') AS ITMCATGRP_ID,ISNULL(CONVERT(VARCHAR,MODEL_PRICE_INGL_CURR),'') AS MODEL_PRICE_INGL_CURR,ISNULL(CONVERT(VARCHAR,NET_PRICE_INGL_CURR),'') AS NET_PRICE_INGL_CURR,ISNULL(CONVERT(VARCHAR,NET_VALUE_INGL_CURR),'') AS NET_VALUE_INGL_CURR,ISNULL(CONVERT(VARCHAR,SLSDIS_PRICE_INGL_CURR),'') AS SLSDIS_PRICE_INGL_CURR,ISNULL(CONVERT(VARCHAR,TARGET_PRICE_INGL_CURR),'') AS TARGET_PRICE_INGL_CURR,ISNULL(CONVERT(VARCHAR,TAX_AMOUNT_INGL_CURR),'') AS TAX_AMOUNT_INGL_CURR,ISNULL(CONVERT(VARCHAR,TOTAL_COST_WOSEEDSTOCK),'') AS TOTAL_COST_WOSEEDSTOCK,ISNULL(CONVERT(VARCHAR,TOTAL_COST_WSEEDSTOCK),'') AS TOTAL_COST_WSEEDSTOCK,ISNULL(CONVERT(VARCHAR,YEAR_1_INGL_CURR),'') AS YEAR_1_INGL_CURR,ISNULL(CONVERT(VARCHAR,YEAR_2_INGL_CURR),'') AS YEAR_2_INGL_CURR,ISNULL(CONVERT(VARCHAR,YEAR_3_INGL_CURR),'') AS YEAR_3_INGL_CURR,ISNULL(CONVERT(VARCHAR,YEAR_4_INGL_CURR),'') AS YEAR_4_INGL_CURR,ISNULL(CONVERT(VARCHAR,YEAR_5_INGL_CURR),'') AS YEAR_5_INGL_CURR,ISNULL(CONVERT(VARCHAR,ENTITLEMENT_COST_IMPACT),'') AS ENTITLEMENT_COST_IMPACT,ISNULL(CONVERT(VARCHAR,ENTITLEMENT_PRICE_IMPACT),'') AS ENTITLEMENT_PRICE_IMPACT FROM SAQITM(NOLOCK)  WHERE SAQITM.QUOTE_ID = '"+str(Qt_ID)+"' AND SAQITM.QTEREV_ID = '"+str(Revision_ID)+"') t 	) A FOR XML PATH ('')  ), 1, 1, '')+']','amp;#','#') AS RESULT)A "
			)
			

		#SAQICO
		SAQICO_QUERY = SqlHelper.GetFirst("SELECT CASE WHEN ISNULL(RESULT,'') = '' THEN '' ELSE RESULT END AS RESULT FROM (SELECT replace ('\"SAQICO\": ['+STUFF((SELECT ','+ JSON FROM (SELECT DISTINCT '{\"ANNUAL_BENCHMARK_BOOKING_PRICE\" : \"'+ANNUAL_BENCHMARK_BOOKING_PRICE+'\",\"BD_DISCOUNT\" : \"'+BD_DISCOUNT+'\",\"BD_PRICE\" : \"'+BD_PRICE+'\",\"BD_PRICE_MARGIN\" : \"'+BD_PRICE_MARGIN+'\",\"BENCHMARKING_THRESHOLD\" : \"'+BENCHMARKING_THRESHOLD+'\",\"CEILING_PRICE\" : \"'+CEILING_PRICE+'\",\"CEILING_PRICE_MARGIN\" : \"'+CEILING_PRICE_MARGIN+'\",\"CLEANING_COST\" : \"'+CLEANING_COST+'\",\"CONTRACT_ID\" : \"'+CONTRACT_ID+'\",\"CONTRACT_VALID_FROM\" : \"'+CONTRACT_VALID_FROM+'\",\"CONTRACT_VALID_TO\" : \"'+CONTRACT_VALID_TO+'\",\"CM_PART_COST\" : \"'+CM_PART_COST+'\",\"CUSTOMER_TOOL_ID\" : \"'+CUSTOMER_TOOL_ID+'\",\"DISCOUNT\" : \"'+DISCOUNT+'\",\"ENTITLEMENT_COST_IMPACT\" : \"'+ENTITLEMENT_COST_IMPACT+'\",\"ENTITLEMENT_PRICE_IMPACT\" : \"'+ENTITLEMENT_PRICE_IMPACT+'\",\"EQUIPMENTCATEGORY_ID\" : \"'+EQUIPMENTCATEGORY_ID+'\",\"EQUIPMENT_ID\" : \"'+EQUIPMENT_ID+'\",\"EQUIPMENT_LINE_ID\" : \"'+EQUIPMENT_LINE_ID+'\",\"EQUIPMENT_QUANTITY\" : \"'+EQUIPMENT_QUANTITY+'\",\"EQUIPMENT_STATUS\" : \"'+EQUIPMENT_STATUS+'\",\"EXCHANGE_RATE\" : \"'+EXCHANGE_RATE+'\",\"EXCHANGE_RATE_DATE\" : \"'+EXCHANGE_RATE_DATE+'\",\"FABLOCATION_ID\" : \"'+FABLOCATION_ID+'\",\"FAB_VALUEDRIVER_COEFFICIENT\" : \"'+FAB_VALUEDRIVER_COEFFICIENT+'\",\"GLOBAL_CURRENCY\" : \"'+GLOBAL_CURRENCY+'\",\"GREENBOOK\" : \"'+GREENBOOK+'\",\"KPI_COST\" : \"'+KPI_COST+'\",\"LABOR_COST\" : \"'+LABOR_COST+'\",\"LINE\" : \"'+LINE+'\",\"LINE_ITEM_ID\" : \"'+LINE_ITEM_ID+'\",\"MNT_PLANT_ID\" : \"'+MNT_PLANT_ID+'\",\"PLATFORM\" : \"'+PLATFORM+'\",\"PM_PART_COST\" : \"'+PM_PART_COST+'\",\"PRICE_BENCHMARK_TYPE\" : \"'+PRICE_BENCHMARK_TYPE+'\",\"QUOTE_ID\" : \"'+QUOTE_ID+'\",\"SALES_DISCOUNT_PRICE\" : \"'+SALES_DISCOUNT_PRICE+'\",\"SORG_CURRENCY\" : \"'+SORG_CURRENCY+'\",\"SALESORG_ID\" : \"'+SALESORG_ID+'\",\"SALES_PRICE\" : \"'+SALES_PRICE+'\" ,\"SAP_PART_NUMBER\" : \"'+SAP_PART_NUMBER+'\",\"SERIAL_NO\" : \"'+SERIAL_NO+'\",\"SERVICE_ID\" : \"'+SERVICE_ID+'\",\"SRVTAXCAT_ID\" : \"'+SRVTAXCAT_ID+'\",\"SRVTAXCLA_ID\" : \"'+SRVTAXCLA_ID+'\" ,\"SRCACC_ID\" : \"'+SRCACC_ID+'\",\"SRCFBL_ID\" : \"'+SRCFBL_ID+'\",\"STATUS\" : \"'+STATUS+'\",\"TARGET_PRICE\" : \"'+TARGET_PRICE+'\",\"TARGET_PRICE_MARGIN\" : \"'+TARGET_PRICE_MARGIN+'\" ,\"TAX\" : \"'+TAX+'\",\"TAX_PERCENTAGE\" : \"'+TAX_PERCENTAGE+'\",\"TECHNOLOGY\" : \"'+TECHNOLOGY+'\",\"TOOL_CONFIGURATION\" : \"'+TOOL_CONFIGURATION+'\",\"TOOL_VALUEDRIVER_COEFFICIENT\" : \"'+TOOL_VALUEDRIVER_COEFFICIENT+'\" ,\"WARRANTY_END_DATE\" : \"'+WARRANTY_END_DATE+'\",\"WARRANTY_START_DATE\" : \"'+WARRANTY_START_DATE+'\",\"YEAR_1\" : \"'+YEAR_1+'\",\"YEAR_2\" : \"'+YEAR_2+'\",\"YEAR_3\" : \"'+YEAR_3+'\",\"YEAR_4\" : \"'+YEAR_4+'\",\"YEAR_5\" : \"'+YEAR_5+'\",\"YEAR_OVER_YEAR\" : \"'+YEAR_OVER_YEAR+'\",\"QTEREV_ID\" : \"'+QTEREV_ID+'\",\"BD_PRICE_INGL_CURR\" : \"'+BD_PRICE_INGL_CURR+'\",\"CEILING_PRICE_INGL_CURR\" : \"'+CEILING_PRICE_INGL_CURR+'\",\"DISCOUNT_AMOUNT_INGL_CURR\" : \"'+DISCOUNT_AMOUNT_INGL_CURR+'\",\"ENTPRCIMP_INGL_CURR\" : \"'+ENTPRCIMP_INGL_CURR+'\",\"MODEL_PRICE_INGL_CURR\" : \"'+MODEL_PRICE_INGL_CURR+'\",\"NET_PRICE_INGL_CURR\" : \"'+NET_PRICE_INGL_CURR+'\",\"NET_VALUE_INGL_CURR\" : \"'+NET_VALUE_INGL_CURR+'\",\"SLSDIS_PRICE_INGL_CURR\" : \"'+SLSDIS_PRICE_INGL_CURR+'\",\"TARGET_PRICE_INGL_CURR\" : \"'+TARGET_PRICE_INGL_CURR+'\",\"TAX_AMOUNT_INGL_CURR\" : \"'+TAX_AMOUNT_INGL_CURR+'\",\"TOTAL_COST_WOSEEDSTOCK\" : \"'+TOTAL_COST_WOSEEDSTOCK+'\",\"TOTAL_COST_WSEEDSTOCK\" : \"'+TOTAL_COST_WSEEDSTOCK+'\",\"YEAR_1_INGL_CURR\" : \"'+YEAR_1_INGL_CURR+'\",\"YEAR_2_INGL_CURR\" : \"'+YEAR_2_INGL_CURR+'\",\"YEAR_3_INGL_CURR\" : \"'+YEAR_3_INGL_CURR+'\",\"YEAR_4_INGL_CURR\" : \"'+YEAR_4_INGL_CURR+'\",\"YEAR_5_INGL_CURR\" : \"'+YEAR_5_INGL_CURR+'\",\"ASSEMBLY_ID\" : \"'+ASSEMBLY_ID+'\" }' AS JSON from (SELECT DISTINCT  ISNULL(CONVERT(VARCHAR,ANNUAL_BENCHMARK_BOOKING_PRICE),'')	AS	ANNUAL_BENCHMARK_BOOKING_PRICE,ISNULL(CONVERT(VARCHAR,BD_DISCOUNT),'') AS BD_DISCOUNT,ISNULL(CONVERT(VARCHAR,BD_PRICE),'') AS	BD_PRICE,ISNULL(CONVERT(VARCHAR,BD_PRICE_MARGIN),'') AS BD_PRICE_MARGIN,ISNULL(CONVERT(VARCHAR,BENCHMARKING_THRESHOLD),'')	AS	BENCHMARKING_THRESHOLD,ISNULL(CONVERT(VARCHAR,CEILING_PRICE),'') AS CEILING_PRICE,ISNULL(CONVERT(VARCHAR,CEILING_PRICE_MARGIN),'') AS CEILING_PRICE_MARGIN,ISNULL(CONVERT(VARCHAR,CLEANING_COST),'') AS	CLEANING_COST,ISNULL(CONTRACT_ID,'') AS CONTRACT_ID,ISNULL(CONVERT(VARCHAR(11),CONTRACT_VALID_FROM,101),'') AS CONTRACT_VALID_FROM,ISNULL(CONVERT(VARCHAR(11),CONTRACT_VALID_TO,101),'') AS CONTRACT_VALID_TO,ISNULL(CONVERT(VARCHAR,CM_PART_COST),'') AS CM_PART_COST,ISNULL(CUSTOMER_TOOL_ID,'') AS	CUSTOMER_TOOL_ID,ISNULL(CONVERT(VARCHAR,DISCOUNT),'')	AS	DISCOUNT,ISNULL(CONVERT(VARCHAR,ENTITLEMENT_COST_IMPACT),'') AS	ENTITLEMENT_COST_IMPACT,ISNULL(CONVERT(VARCHAR,ENTITLEMENT_PRICE_IMPACT),'') AS	ENTITLEMENT_PRICE_IMPACT,ISNULL(EQUIPMENTCATEGORY_ID,'') AS	EQUIPMENTCATEGORY_ID,ISNULL(EQUIPMENT_ID,'') AS	EQUIPMENT_ID,ISNULL(CONVERT(VARCHAR,EQUIPMENT_LINE_ID),'') AS EQUIPMENT_LINE_ID,ISNULL(CONVERT(VARCHAR,EQUIPMENT_QUANTITY),'') AS	EQUIPMENT_QUANTITY,ISNULL(EQUIPMENT_STATUS,'') AS EQUIPMENT_STATUS,ISNULL(CONVERT(VARCHAR,EXCHANGE_RATE),'') AS	EXCHANGE_RATE,ISNULL(CONVERT(VARCHAR(11),EXCHANGE_RATE_DATE,101),'') AS	EXCHANGE_RATE_DATE,ISNULL(FABLOCATION_ID,'') AS FABLOCATION_ID,ISNULL(CONVERT(VARCHAR,FAB_VALUEDRIVER_COEFFICIENT),'') AS	FAB_VALUEDRIVER_COEFFICIENT,ISNULL(GLOBAL_CURRENCY,'') AS GLOBAL_CURRENCY,ISNULL(GREENBOOK,'') AS GREENBOOK,ISNULL(CONVERT(VARCHAR,KPI_COST),'') AS KPI_COST,ISNULL(CONVERT(VARCHAR,LABOR_COST),'') AS LABOR_COST,ISNULL(LINE,'') AS LINE,ISNULL(LINE_ITEM_ID,'') AS LINE_ITEM_ID,ISNULL(MNT_PLANT_ID,'') AS	MNT_PLANT_ID,ISNULL(PLATFORM,'') AS PLATFORM,ISNULL(CONVERT(VARCHAR,PM_PART_COST),'') AS	PM_PART_COST,ISNULL(PRICE_BENCHMARK_TYPE,'') AS	PRICE_BENCHMARK_TYPE ,ISNULL(QUOTE_ID,'') AS QUOTE_ID,ISNULL(CONVERT(VARCHAR,SALES_DISCOUNT_PRICE),'') AS SALES_DISCOUNT_PRICE,ISNULL(DOC_CURRENCY,'') AS	SORG_CURRENCY,ISNULL(SALESORG_ID,'') AS SALESORG_ID,ISNULL(CONVERT(VARCHAR,NET_PRICE),'') AS SALES_PRICE,ISNULL(SAP_PART_NUMBER,'') AS	SAP_PART_NUMBER,ISNULL(SERIAL_NO,'') AS SERIAL_NO,ISNULL(SERVICE_ID,'') AS	SERVICE_ID,ISNULL(SRVTAXCAT_ID,'') AS	SRVTAXCAT_ID,ISNULL(SRVTAXCLA_ID,'') AS SRVTAXCLA_ID ,ISNULL(SRCACC_ID,'') AS SRCACC_ID,ISNULL(SRCFBL_ID,'') AS SRCFBL_ID,ISNULL(STATUS,'') AS STATUS,ISNULL(CONVERT(VARCHAR,TARGET_PRICE),'') AS TARGET_PRICE,ISNULL(CONVERT(VARCHAR,TARGET_PRICE_MARGIN),'') AS TARGET_PRICE_MARGIN,ISNULL(CONVERT(VARCHAR,TAX_AMOUNT),'') AS TAX,ISNULL(CONVERT(VARCHAR,TAX_PERCENTAGE),'') AS	TAX_PERCENTAGE,ISNULL(TECHNOLOGY,'') AS TECHNOLOGY,ISNULL(TOOL_CONFIGURATION,'') AS TOOL_CONFIGURATION,ISNULL(CONVERT(VARCHAR,TOOL_VALUEDRIVER_COEFFICIENT),'') AS TOOL_VALUEDRIVER_COEFFICIENT,ISNULL(WARRANTY_END_DATE,'') AS	WARRANTY_END_DATE,ISNULL(WARRANTY_START_DATE,'') AS WARRANTY_START_DATE,ISNULL(CONVERT(VARCHAR,YEAR_1),'') AS YEAR_1,ISNULL(CONVERT(VARCHAR,YEAR_2),'') AS YEAR_2,ISNULL(CONVERT(VARCHAR,YEAR_3),'') AS YEAR_3,ISNULL(CONVERT(VARCHAR,YEAR_4),'') AS YEAR_4,ISNULL(CONVERT(VARCHAR,YEAR_5),'') AS YEAR_5,ISNULL(CONVERT(VARCHAR,YEAR_OVER_YEAR),'') AS YEAR_OVER_YEAR,ISNULL(QTEREV_ID,'') AS QTEREV_ID,ISNULL(CONVERT(VARCHAR,BD_PRICE_INGL_CURR),'') AS BD_PRICE_INGL_CURR,ISNULL(CONVERT(VARCHAR,CEILING_PRICE_INGL_CURR),'') AS CEILING_PRICE_INGL_CURR,ISNULL(CONVERT(VARCHAR,DISCOUNT_AMOUNT_INGL_CURR),'') AS DISCOUNT_AMOUNT_INGL_CURR,ISNULL(CONVERT(VARCHAR,ENTPRCIMP_INGL_CURR),'') AS ENTPRCIMP_INGL_CURR,ISNULL(CONVERT(VARCHAR,MODEL_PRICE_INGL_CURR),'') AS MODEL_PRICE_INGL_CURR,ISNULL(CONVERT(VARCHAR,NET_PRICE_INGL_CURR),'') AS NET_PRICE_INGL_CURR,ISNULL(CONVERT(VARCHAR,NET_VALUE_INGL_CURR),'') AS NET_VALUE_INGL_CURR,ISNULL(CONVERT(VARCHAR,SLSDIS_PRICE_INGL_CURR),'') AS SLSDIS_PRICE_INGL_CURR,ISNULL(CONVERT(VARCHAR,TARGET_PRICE_INGL_CURR),'') AS TARGET_PRICE_INGL_CURR,ISNULL(CONVERT(VARCHAR,TAX_AMOUNT_INGL_CURR),'') AS TAX_AMOUNT_INGL_CURR,ISNULL(CONVERT(VARCHAR,TOTAL_COST_WOSEEDSTOCK),'') AS TOTAL_COST_WOSEEDSTOCK,ISNULL(CONVERT(VARCHAR,TOTAL_COST_WSEEDSTOCK),'') AS TOTAL_COST_WSEEDSTOCK,ISNULL(CONVERT(VARCHAR,YEAR_1_INGL_CURR),'') AS YEAR_1_INGL_CURR,ISNULL(CONVERT(VARCHAR,YEAR_2_INGL_CURR),'') AS YEAR_2_INGL_CURR,ISNULL(CONVERT(VARCHAR,YEAR_3_INGL_CURR),'') AS YEAR_3_INGL_CURR,ISNULL(CONVERT(VARCHAR,YEAR_4_INGL_CURR),'') AS YEAR_4_INGL_CURR,ISNULL(CONVERT(VARCHAR,YEAR_5_INGL_CURR),'') AS YEAR_5_INGL_CURR,ISNULL(ASSEMBLY_ID,'') AS	ASSEMBLY_ID FROM SAQICO(NOLOCK)  WHERE SAQICO.QUOTE_ID = '"+str(Qt_ID)+"' AND SAQICO.QTEREV_ID = '"+str(Revision_ID)+"' ) t 	) A FOR XML PATH ('')  ), 1, 1, '')+']','amp;#','#') AS RESULT)A ")


		#SAQICA
		SAQICA_QUERY = SqlHelper.GetFirst(
				"SELECT CASE WHEN ISNULL(RESULT,'') = '' THEN '' ELSE RESULT END AS RESULT FROM (SELECT replace ('\"SAQICA\": ['+STUFF((SELECT ','+ JSON FROM (SELECT DISTINCT '{\"ASSEMBLY_ID\" : \"'+ASSEMBLY_ID+'\",\"ASSEMBLY_STATUS\" : \"'+ASSEMBLY_STATUS+'\",\"EQUIPMENTCATEGORY_ID\" : \"'+EQUIPMENTCATEGORY_ID+'\",\"EQUIPMENT_ID\" : \"'+EQUIPMENT_ID+'\",\"EQUIPMENT_LINE_ID\" : \"'+EQUIPMENT_LINE_ID+'\",\"EQUIPMENTTYPE_ID\" : \"'+EQUIPMENTTYPE_ID+'\",\"FABLOCATION_ID\" : \"'+FABLOCATION_ID+'\",\"GOT_CODE\" : \"'+GOT_CODE+'\",\"INCLUDED\" : \"'+INCLUDED+'\"	,\"LINE_ITEM_ID\" : \"'+LINE_ITEM_ID+'\",\"MNT_PLANT_ID\" : \"'+MNT_PLANT_ID+'\",\"PLATFORM\" : \"'+PLATFORM+'\",\"QUOTE_ID\" : \"'+QUOTE_ID+'\",\"SALESORG_ID\" : \"'+SALESORG_ID+'\",\"SERIAL_NUMBER\" : \"'+SERIAL_NUMBER+'\",\"SERVICE_ID\" : \"'+SERVICE_ID+'\",\"QTEREV_ID\" : \"'+QTEREV_ID+'\",\"CLEANING_COST\" : \"'+CLEANING_COST+'\",\"CM_PART_COST\" : \"'+CM_PART_COST+'\",\"KPI_COST\" : \"'+KPI_COST+'\",\"LABOR_COST\" : \"'+LABOR_COST+'\",\"PM_PART_COST\" : \"'+PM_PART_COST+'\",\"TOTAL_COST_WOSEEDSTOCK\" : \"'+TOTAL_COST_WOSEEDSTOCK+'\",\"TOTAL_COST_WSEEDSTOCK\" : \"'+TOTAL_COST_WSEEDSTOCK+'\"}' AS JSON from (SELECT DISTINCT  ISNULL(ASSEMBLY_ID,'') AS	ASSEMBLY_ID,ISNULL(ASSEMBLY_STATUS,'') AS	ASSEMBLY_STATUS,ISNULL(EQUIPMENTCATEGORY_ID,'')	AS	EQUIPMENTCATEGORY_ID,ISNULL(EQUIPMENT_ID,'') AS	EQUIPMENT_ID,ISNULL(CONVERT(VARCHAR,EQUIPMENT_LINE_ID),'')	AS	EQUIPMENT_LINE_ID,ISNULL(EQUIPMENTTYPE_ID,'')	AS	EQUIPMENTTYPE_ID,ISNULL(FABLOCATION_ID,'')	AS	FABLOCATION_ID,ISNULL(GOT_CODE,'')	AS	GOT_CODE,ISNULL(CONVERT(VARCHAR,INCLUDED),'')  AS INCLUDED,'' AS LINE_ITEM_ID,ISNULL(MNT_PLANT_ID,'')	AS	MNT_PLANT_ID,ISNULL(PLATFORM,'') AS	PLATFORM,ISNULL(QUOTE_ID,'') AS	QUOTE_ID,ISNULL(SALESORG_ID,'')	AS	SALESORG_ID,ISNULL(SERIAL_NUMBER,'') AS SERIAL_NUMBER,ISNULL(SERVICE_ID,'')	AS	SERVICE_ID,ISNULL(QTEREV_ID,'') AS	QTEREV_ID,ISNULL(CONVERT(VARCHAR,CLEANING_COST),'') AS CLEANING_COST,ISNULL(CONVERT(VARCHAR,CM_PART_COST),'') AS CM_PART_COST,ISNULL(CONVERT(VARCHAR,KPI_COST),'') AS KPI_COST,ISNULL(CONVERT(VARCHAR,LABOR_COST),'') AS LABOR_COST,ISNULL(CONVERT(VARCHAR,PM_PART_COST),'') AS PM_PART_COST,ISNULL(CONVERT(VARCHAR,TOTAL_COST_WOSEEDSTOCK),'') AS TOTAL_COST_WOSEEDSTOCK,ISNULL(CONVERT(VARCHAR,TOTAL_COST_WSEEDSTOCK),'') AS TOTAL_COST_WSEEDSTOCK FROM SAQICA(NOLOCK)  WHERE SAQICA.QUOTE_ID = '"+str(Qt_ID)+"' AND SAQICA.QTEREV_ID = '"+str(Revision_ID)+"' ) t 	) A FOR XML PATH ('')  ), 1, 1, '')+']','amp;#','#') AS RESULT)A "
			)

		#SAQAPP
		SAQAPP_QUERY = SqlHelper.GetFirst(
				"SELECT CASE WHEN ISNULL(RESULT,'') = '' THEN '' ELSE RESULT END AS RESULT FROM (SELECT replace ('\"SAQAPP\": ['+STUFF((SELECT ','+ JSON FROM (SELECT DISTINCT '{\"ASSEMBLY_ID\" : \"'+ASSEMBLY_ID+'\",\"EQUIPMENT_ID\" : \"'+EQUIPMENT_ID+'\",\"EQUIPMENT_LINE_ID\" : \"'+EQUIPMENT_LINE_ID+'\",\"LINE_ITEM_ID\" : \"'+LINE_ITEM_ID+'\",\"KIT_ID\" : \"'+KIT_ID+'\",\"KIT_NAME\" : \"'+KIT_NAME+'\",\"KIT_NUMBER\" : \"'+KIT_NUMBER+'\",\"PART_NUMBER\" : \"'+PART_NUMBER+'\",\"PM_FREQUENCY\" : \"'+PM_FREQUENCY+'\",\"PM_ID\" : \"'+PM_ID+'\",\"QUANTITY\" : \"'+QUANTITY+'\",\"QUOTE_ID\" : \"'+QUOTE_ID+'\",\"TKM_FLAG\" : \"'+TKM_FLAG+'\" ,\"QTEREV_ID\" : \"'+QTEREV_ID+'\"}' AS JSON from (SELECT DISTINCT  ISNULL(SAQAPP.ASSEMBLY_ID,'') AS	ASSEMBLY_ID,ISNULL(SAQAPP.EQUIPMENT_ID,'') AS	EQUIPMENT_ID,ISNULL(CONVERT(VARCHAR,EQUIPMENT_LINE_ID),'')	AS	EQUIPMENT_LINE_ID,LINE_ITEM_ID AS LINE_ITEM_ID,ISNULL(KIT_ID,'')	AS	KIT_ID,ISNULL(KIT_NAME,'') AS	KIT_NAME,ISNULL(KIT_NUMBER,'') AS	KIT_NUMBER,ISNULL(PART_NUMBER,'')	AS	PART_NUMBER,ISNULL(CONVERT(VARCHAR,PM_FREQUENCY),'') AS PM_FREQUENCY,ISNULL(PM_ID,'')	AS	PM_ID,ISNULL(CONVERT(VARCHAR,QUANTITY),'') AS QUANTITY,ISNULL(SAQAPP.QUOTE_ID,'') AS	QUOTE_ID,'' AS TKM_FLAG,ISNULL(SAQAPP.QTEREV_ID,'') AS	QTEREV_ID FROM SAQSKP SAQAPP (NOLOCK) JOIN SAQICO (NOLOCK) B ON SAQAPP.QUOTE_ID = B.QUOTE_ID AND SAQAPP.QTEREV_ID = B.QTEREV_ID AND SAQAPP.SERVICE_ID = B.SERVICE_ID AND SAQAPP.EQUIPMENT_ID = B.EQUIPMENT_ID WHERE SAQAPP.QUOTE_ID = '"+str(Qt_ID)+"' AND SAQAPP.QTEREV_ID = '"+str(Revision_ID)+"') t 	) A FOR XML PATH ('')  ), 1, 1, '')+']','amp;#','#') AS RESULT)A "
			)

		#SAQIFP
		SAQIFP_QUERY = SqlHelper.GetFirst(
				"SELECT CASE WHEN ISNULL(RESULT,'') = '' THEN '' ELSE RESULT END AS RESULT FROM ( SELECT replace ('\"SAQIFP\": ['+STUFF((SELECT ','+ JSON FROM (SELECT DISTINCT '{\"ANNUAL_QUANTITY\" : \"'+ANNUAL_QUANTITY+'\",\"BASEUOM_ID\" : \"'+BASEUOM_ID+'\",\"CUSTOMER_PART_NUMBER\" : \"'+CUSTOMER_PART_NUMBER+'\",\"DELIVERY_MODE\" : \"'+DELIVERY_MODE+'\",\"EXTENDED_PRICE\" : \"'+EXTENDED_PRICE+'\",\"LINE\" : \"'+LINE+'\",\"LINE_ITEM_ID\" : \"'+LINE_ITEM_ID+'\",\"MATPRIGRP_ID\" : \"'+MATPRIGRP_ID+'\",\"Part_Line_ID\" : \"'+Part_Line_ID+'\",\"PART_NUMBER\" : \"'+PART_NUMBER+'\",\"PRICINGPROCEDURE_ID\" : \"'+PRICINGPROCEDURE_ID+'\",\"PRICING_STATUS\" : \"'+PRICING_STATUS+'\",\"QUOTE_ID\" : \"'+QUOTE_ID+'\",\"SORG_CURRENCY\" : \"'+SORG_CURRENCY+'\",\"SALESORG_ID\" : \"'+SALESORG_ID+'\",\"SALESUOM_CONVERSION_FACTOR\" : \"'+SALESUOM_CONVERSION_FACTOR+'\",\"SALESUOM_ID\" : \"'+SALESUOM_ID+'\" ,\"SCHEDULE_MODE\" : \"'+SCHEDULE_MODE+'\",\"SERVICE_ID\" : \"'+SERVICE_ID+'\",\"SRVTAXCAT_ID\" : \"'+SRVTAXCAT_ID+'\",\"SRVTAXCLA_ID\" : \"'+SRVTAXCLA_ID+'\",\"TAX\" : \"'+TAX+'\",\"TAX_PERCENTAGE\" : \"'+TAX_PERCENTAGE+'\",\"UNIT_PRICE\" : \"'+UNIT_PRICE+'\",\"VALID_FROM_DATE\" : \"'+VALID_FROM_DATE+'\",\"VALID_TO_DATE\" : \"'+VALID_TO_DATE+'\" ,\"QTEREV_ID\" : \"'+QTEREV_ID+'\"}' AS JSON from (SELECT DISTINCT  ISNULL(CONVERT(VARCHAR,ANNUAL_QUANTITY),'') AS ANNUAL_QUANTITY,ISNULL(BASEUOM_ID,'') AS	BASEUOM_ID,ISNULL(CUSTOMER_PART_NUMBER,'')	AS	CUSTOMER_PART_NUMBER,ISNULL(DELIVERY_MODE,'') AS	DELIVERY_MODE,ISNULL(CONVERT(VARCHAR,EXTENDED_PRICE),'') AS	EXTENDED_PRICE,ISNULL(LINE,'')	AS	LINE,ISNULL(LINE_ITEM_ID,'')	AS	LINE_ITEM_ID,ISNULL(MATPRIGRP_ID,'') AS	MATPRIGRP_ID,ISNULL(CONVERT(VARCHAR,Part_Line_ID),'')  AS Part_Line_ID,ISNULL(PART_NUMBER,'') AS PART_NUMBER,ISNULL(PRICINGPROCEDURE_ID,'')	AS	PRICINGPROCEDURE_ID,ISNULL(PRICING_STATUS,'') AS	PRICING_STATUS,ISNULL(QUOTE_ID,'') AS	QUOTE_ID,ISNULL(DOC_CURRENCY,'') AS SORG_CURRENCY,ISNULL(SALESORG_ID,'')	AS	SALESORG_ID,ISNULL(CONVERT(VARCHAR,SALESUOM_CONVERSION_FACTOR),'') AS SALESUOM_CONVERSION_FACTOR,ISNULL(SALESUOM_ID,'')	AS SALESUOM_ID,ISNULL(SCHEDULE_MODE,'')  AS SCHEDULE_MODE,ISNULL(SERVICE_ID,'') AS SERVICE_ID,ISNULL(SRVTAXCAT_ID,'')	AS	SRVTAXCAT_ID,ISNULL(SRVTAXCLA_ID,'') AS	SRVTAXCLA_ID,ISNULL(CONVERT(VARCHAR,TAX),'') AS	TAX,ISNULL(CONVERT(VARCHAR,TAX_PERCENTAGE),'') AS TAX_PERCENTAGE,ISNULL(CONVERT(VARCHAR,UNIT_PRICE),'')	AS	UNIT_PRICE,ISNULL(CONVERT(VARCHAR(11),VALID_FROM_DATE,101),'') AS VALID_FROM_DATE,ISNULL(CONVERT(VARCHAR(11),VALID_TO_DATE,101),'')	AS	VALID_TO_DATE ,ISNULL(QTEREV_ID,'') AS	QTEREV_ID FROM SAQIFP(NOLOCK)  WHERE SAQIFP.QUOTE_ID = '"+str(Qt_ID)+"' AND SAQIFP.QTEREV_ID = '"+str(Revision_ID)+"' ) t 	) A FOR XML PATH ('')  ), 1, 1, '')+']','amp;#','#') AS RESULT)A "
			)

		#SAQIBP
		SAQIBP_QUERY = SqlHelper.GetFirst(
				"SELECT CASE WHEN ISNULL(RESULT,'') = '' THEN '' ELSE RESULT END AS RESULT FROM ( SELECT replace ('\"SAQIBP\": ['+STUFF((SELECT ','+ JSON FROM (SELECT DISTINCT '{\"ANNUAL_BILLING_AMOUNT\" : \"'+ANNUAL_BILLING_AMOUNT+'\",\"BILLING_AMOUNT\" : \"'+BILLING_AMOUNT+'\",\"BILLING_CURRENCY\" : \"'+BILLING_CURRENCY+'\",\"BILLING_DATE\" : \"'+BILLING_DATE+'\",\"BILLING_DAY\" : \"'+BILLING_DAY+'\",\"BILLING_END_DATE\" : \"'+BILLING_END_DATE+'\",\"BILLING_INTERVAL\" : \"'+BILLING_INTERVAL+'\",\"BILLING_START_DATE\" : \"'+BILLING_START_DATE+'\",\"BILLING_TYPE\" : \"'+BILLING_TYPE+'\",\"BILLING_YEAR\" : \"'+BILLING_YEAR+'\",\"EQUIPMENT_ID\" : \"'+EQUIPMENT_ID+'\",\"EQUIPMENT_LINE_ID\" : \"'+EQUIPMENT_LINE_ID+'\",\"EQUIPMENT_QUANTITY\" : \"'+EQUIPMENT_QUANTITY+'\",\"GREENBOOK\" : \"'+GREENBOOK+'\",\"LINE_ITEM_ID\" : \"'+LINE_ITEM_ID+'\",\"PO_ITEM\" : \"'+PO_ITEM+'\",\"PO_NUMBER\" : \"'+PO_NUMBER+'\" ,\"QUOTE_ID\" : \"'+QUOTE_ID+'\",\"QUOTE_NAME\" : \"'+QUOTE_NAME+'\",\"SALESORG_ID\" : \"'+SALESORG_ID+'\",\"SERVICE_ID\" : \"'+SERVICE_ID+'\",\"SPLIT_BILLING\" : \"'+SPLIT_BILLING+'\",\"WARRANTY_END_DATE\" : \"'+WARRANTY_END_DATE+'\",\"WARRANTY_START_DATE\" : \"'+WARRANTY_START_DATE+'\",\"QTEREV_ID\" : \"'+QTEREV_ID+'\"}' AS JSON from (SELECT DISTINCT  ISNULL(CONVERT(VARCHAR,ANNUAL_BILLING_AMOUNT),'') AS ANNUAL_BILLING_AMOUNT,ISNULL(CONVERT(VARCHAR,BILLING_AMOUNT),'') AS	BILLING_AMOUNT,ISNULL(BILLING_CURRENCY,'')	AS	BILLING_CURRENCY,ISNULL(CONVERT(VARCHAR(11),BILLING_DATE,101),'') AS BILLING_DATE,ISNULL(CONVERT(VARCHAR,BILLING_DAY),'') AS	BILLING_DAY,ISNULL(CONVERT(VARCHAR(11),BILLING_END_DATE,101),'')	AS	BILLING_END_DATE,ISNULL(BILLING_INTERVAL,'') AS	BILLING_INTERVAL,ISNULL(CONVERT(VARCHAR(11),BILLING_START_DATE,101),'') AS	BILLING_START_DATE,ISNULL(BILLING_TYPE,'')  AS BILLING_TYPE,ISNULL(CONVERT(VARCHAR,BILLING_YEAR),'') AS BILLING_YEAR,ISNULL(EQUIPMENT_ID,'')	AS	EQUIPMENT_ID,ISNULL(CONVERT(VARCHAR,EQUIPMENT_LINE_ID),'') AS EQUIPMENT_LINE_ID,ISNULL(CONVERT(VARCHAR,EQUIPMENT_QUANTITY),'') AS	EQUIPMENT_QUANTITY,ISNULL(GREENBOOK,'') AS GREENBOOK,ISNULL(LINE_ITEM_ID,'')	AS	LINE_ITEM_ID,ISNULL(PO_ITEM,'') AS PO_ITEM,ISNULL(PO_NUMBER,'')	AS PO_NUMBER,ISNULL(QUOTE_ID,'')  AS QUOTE_ID,ISNULL(QUOTE_NAME,'') AS QUOTE_NAME,ISNULL(SALESORG_ID,'')	AS	SALESORG_ID,ISNULL(SERVICE_ID,'') AS SERVICE_ID,ISNULL(CONVERT(VARCHAR,SPLIT_BILLING),'') AS SPLIT_BILLING,ISNULL(CONVERT(VARCHAR(11),WARRANTY_END_DATE,101),'') AS WARRANTY_END_DATE,ISNULL(CONVERT(VARCHAR(11),WARRANTY_START_DATE,101),'')	AS	WARRANTY_START_DATE,ISNULL(QTEREV_ID,'') AS	QTEREV_ID FROM SAQIBP(NOLOCK)  WHERE SAQIBP.QUOTE_ID = '"+str(Qt_ID)+"' AND SAQIBP.QTEREV_ID = '"+str(Revision_ID)+"') t 	) A FOR XML PATH ('')  ), 1, 1, '')+']','amp;#','#') AS RESULT)A "
			)

		"""
		#SAQSCV
		SAQSCV_QUERY = SqlHelper.GetFirst(
				"SELECT replace ('\"SAQSCV\": ['+STUFF((SELECT ','+ JSON FROM (SELECT DISTINCT '{\"TOOLVALUEDRIVER_DISPLAY_VALUE\" : \"'+TOOLVALUEDRIVER_DISPLAY_VALUE+'\",\"TOOLVALUEDRIVER_VALUE_CODE\" : \"'+TOOL_VALUEDRIVER_VALUE_CODE+'\",\"TOOLVALUEDRIVER_NAME\" : \"'+TOOLVALUEDRIVER_NAME+'\",\"TOOLVALUEDRIVER_ID\" : \"'+TOOL_VALUEDRIVER_ID+'\",\"EQUIPMENT_ID\" : \"'+EQUIPMENT_ID+'\",\"EQUIPMENT_LINE_ID\" : \"'+EQUIPMENT_LINE_ID+'\",\"QUOTE_ID\" : \"'+QUOTE_ID+'\",\"SERVICE_ID\" : \"'+SERVICE_ID+'\",\"TOOLVALUEDRIVER_COEFFICIENT\" : \"'+VALUEDRIVER_COEFFICIENT+'\",\"LINE_ITEM_ID\" : \"'+LINE_ITEM_ID+'\",\"QTEREV_ID\" : \"'+QTEREV_ID+'\" }' AS JSON from (SELECT DISTINCT  '' AS TOOLVALUEDRIVER_DISPLAY_VALUE,ISNULL(TOOL_VALUEDRIVER_VALUE_CODE,'') AS	TOOL_VALUEDRIVER_VALUE_CODE,ISNULL(TOOL_VALUEDRIVER_ID,'')	AS	TOOLVALUEDRIVER_NAME,ISNULL(TOOL_VALUEDRIVER_ID,'') AS TOOL_VALUEDRIVER_ID,ISNULL(SAQSCV.EQUIPMENT_ID,'') AS	EQUIPMENT_ID,CONVERT(VARCHAR,EQUIPMENT_LINE_ID) AS	EQUIPMENT_LINE_ID,ISNULL(SAQSCV.QUOTE_ID,'') AS QUOTE_ID,ISNULL(SAQSCV.SERVICE_ID,'') AS	SERVICE_ID,ISNULL(CONVERT(VARCHAR,VALUEDRIVER_COEFFICIENT),'')  AS VALUEDRIVER_COEFFICIENT,LINE_ITEM_ID AS LINE_ITEM_ID,ISNULL(SAQSCV.QTEREV_ID,'') AS	QTEREV_ID FROM SAQSCV(NOLOCK)  JOIN SAQICO (NOLOCK) B ON SAQSCV.QUOTE_ID = B.QUOTE_ID AND SAQSCV.QTEREV_ID = B.QTEREV_ID AND SAQSCV.SERVICE_ID = B.SERVICE_ID AND SAQSCV.EQUIPMENT_ID = B.EQUIPMENT_ID WHERE SAQSCV.QUOTE_ID = '"+str(Qt_ID)+"' AND SAQSCV.QTEREV_ID = '"+str(Revision_ID)+"' ) t 	) A FOR XML PATH ('')  ), 1, 1, '')+']','amp;#','#') AS RESULT "
			)
		
		#SAQTFV
		SAQTFV_QUERY = SqlHelper.GetFirst(
				"SELECT replace ('\"SAQTFV\": ['+STUFF((SELECT ','+ JSON FROM (SELECT DISTINCT '{\"FABVALUEDRIVER_DISPLAY_VALUE\" : \"'+FABVALUEDRIVER_DISPLAY_VALUE+'\",\"FABVALUEDRIVER_VALUE_CODE\" : \"'+FABVALUEDRIVER_VALUE_CODE+'\",\"FABVALUEDRIVER_NAME\" : \"'+FABVALUEDRIVER_NAME+'\",\"FABVALUEDRIVER_ID\" : \"'+FABVALUEDRIVER_ID+'\",\"EQUIPMENT_ID\" : \"'+EQUIPMENT_ID+'\",\"EQUIPMENT_LINE_ID\" : \"'+EQUIPMENT_LINE_ID+'\",\"QUOTE_ID\" : \"'+QUOTE_ID+'\",\"SERVICE_ID\" : \"'+SERVICE_ID+'\",\"FABVALUEDRIVER_COEFFICIENT\" : \"'+FABVALUEDRIVER_COEFFICIENT+'\",\"LINE_ITEM_ID\" : \"'+LINE_ITEM_ID+'\",\"QTEREV_ID\" : \"'+QTEREV_ID+'\" }' AS JSON from (SELECT DISTINCT  VALUEDRIVER_VALUE_DESCRIPTION  AS FABVALUEDRIVER_DISPLAY_VALUE,ISNULL(VALUEDRIVER_VALUE_CODE,'') AS	FABVALUEDRIVER_VALUE_CODE,ISNULL(VALUEDRIVER_NAME,'')	AS	FABVALUEDRIVER_NAME,ISNULL(VALUEDRIVER_ID,'') AS FABVALUEDRIVER_ID,ISNULL(SAQEDV.EQUIPMENT_ID,'') AS	EQUIPMENT_ID,CONVERT(VARCHAR,EQUIPMENT_LINE_ID) AS	EQUIPMENT_LINE_ID,ISNULL(SAQEDV.QUOTE_ID,'') AS QUOTE_ID,ISNULL(B.SERVICE_ID,'') AS	SERVICE_ID,ISNULL(CONVERT(VARCHAR,VALUEDRIVER_COEFFICIENT),'')  AS FABVALUEDRIVER_COEFFICIENT,LINE_ITEM_ID AS LINE_ITEM_ID,ISNULL(SAQEDV.QTEREV_ID,'') AS	QTEREV_ID FROM SAQEDV(NOLOCK) JOIN SAQICO (NOLOCK) B ON SAQEDV.QUOTE_ID = B.QUOTE_ID AND SAQEDV.QTEREV_ID = B.QTEREV_ID AND SAQEDV.EQUIPMENT_ID = B.EQUIPMENT_ID  WHERE SAQEDV.QUOTE_ID = '"+str(Qt_ID)+"' AND SAQEDV.QTEREV_ID = '"+str(Revision_ID)+"' ) t 	) A FOR XML PATH ('')  ), 1, 1, '')+']','amp;#','#') AS RESULT "
			)
			"""
			
		#Entitlement Query 
		start = 1
		end = 1

		tbl_flag = 0
		Check_flag = 1
		while Check_flag == 1:

			ent_query = SqlHelper.GetFirst("SELECT DISTINCT QUOTE_ID,cpqtableentryid FROM (SELECT DISTINCT QUOTE_ID,cpqtableentryid, ROW_NUMBER()OVER(ORDER BY cpqtableentryid) AS SNO FROM SAQIEN (NOLOCK) where SAQIEN.QUOTE_ID='"+str(Qt_ID)+"' AND SAQIEN.QTEREV_ID = '"+str(Revision_ID)+"' AND SERVICE_ID NOT IN (SELECT ADNPRDOFR_ID FROM MAADPR(NOLOCK)) ) A WHERE SNO>= "+str(start)+" AND SNO<="+str(end)+" ")
			SAQIEN = 'SAQIEN_INBOUND'

			if str(ent_query) != "None":
				tbl_flag = 1		
				start = start + 1
				end = end + 1
				
				
				if start == 2:

					SAQIEN_SEL = SqlHelper.GetFirst("sp_executesql @T=N'declare @H int; Declare @val Varchar(MAX);DECLARE @XML XML; SELECT @val = FINAL from(select  REPLACE(entitlement_xml,''<QUOTE_ITEM_ENTITLEMENT>'',sml) AS FINAL FROM (select ''<QUOTE_ITEM_ENTITLEMENT><QUOTE_ID>''+isnull(quote_id,'''')+''</QUOTE_ID><SERVICE_ID>''+isnull(service_id,'''')+''</SERVICE_ID><EQUIPMENT_ID>''+isnull(equipment_id,'''')+''</EQUIPMENT_ID><FABLOCATION_ID>''+isnull(fablocation_id,'''')+''</FABLOCATION_ID><IS_CHANGED>''+isnull(convert(varchar,IS_CHANGED),'''')+''</IS_CHANGED><KB_VERSION>''+isnull(kb_version,'''')+''</KB_VERSION><SALESORG_ID>''+isnull(salesorg_id,'''')+''</SALESORG_ID><SERIAL_NO>''+isnull(serial_no,'''')+''</SERIAL_NO><ENTITLEMENT_GROUP_ID>''+isnull(convert(varchar,entitlement_group_id),'''')+''</ENTITLEMENT_GROUP_ID> 		<EQUIPMENT_LINE_ID>''+isnull(convert(varchar,EQUIPMENT_LINE_ID),'''')+''</EQUIPMENT_LINE_ID><LINE_ITEM_ID>''+isnull(convert(varchar,LINE_ITEM_ID),'''')+''</LINE_ITEM_ID>'' AS sml,replace(entitlement_xml,''&'','';#38'')  as entitlement_xml from SAQIEN(nolock) where quote_id=''"+str(Qt_ID)+"'' AND cpqtableentryid = "+str(ent_query.cpqtableentryid)+" )A )a SELECT @XML = CONVERT(XML,''<ROOT>''+@VAL+''</ROOT>'') exec sys.sp_xml_preparedocument @H output,@XML; select QUOTE_ID,EQUIPMENT_ID,SERVICE_ID,FABLOCATION_ID,IS_CHANGED,KB_VERSION,SALESORG_ID,SERIAL_NO,ENTITLEMENT_GROUP_ID,EQUIPMENT_LINE_ID,LINE_ITEM_ID,ENTITLEMENT_NAME,ENTITLEMENT_DESCRIPTION,ENTITLEMENT_VALUE_CODE,ENTITLEMENT_DISPLAY_VALUE,ENTITLEMENT_COST_IMPACT,ENTITLEMENT_PRICE_IMPACT INTO "+str(SAQIEN)+"  from openxml(@H, ''ROOT/QUOTE_ITEM_ENTITLEMENT'', 0) with (QUOTE_ID VARCHAR(100) ''QUOTE_ID'',EQUIPMENT_ID VARCHAR(100) ''EQUIPMENT_ID'',SERVICE_ID VARCHAR(100) ''SERVICE_ID'',FABLOCATION_ID VARCHAR(100) ''FABLOCATION_ID'',IS_CHANGED VARCHAR(100) ''IS_CHANGED'',KB_VERSION VARCHAR(100) ''KB_VERSION'',SALESORG_ID VARCHAR(100) ''SALESORG_ID'',SERIAL_NO VARCHAR(100) ''SERIAL_NO'',ENTITLEMENT_GROUP_ID VARCHAR(100) ''ENTITLEMENT_GROUP_ID'',EQUIPMENT_LINE_ID VARCHAR(100) ''EQUIPMENT_LINE_ID'',LINE_ITEM_ID VARCHAR(100) ''LINE_ITEM_ID'',ENTITLEMENT_NAME VARCHAR(100) ''ENTITLEMENT_NAME'',ENTITLEMENT_DESCRIPTION VARCHAR(100) ''ENTITLEMENT_DESCRIPTION'',ENTITLEMENT_VALUE_CODE VARCHAR(100) ''ENTITLEMENT_VALUE_CODE'',ENTITLEMENT_DISPLAY_VALUE VARCHAR(100) ''ENTITLEMENT_DISPLAY_VALUE'',ENTITLEMENT_COST_IMPACT VARCHAR(100) ''ENTITLEMENT_COST_IMPACT'',ENTITLEMENT_PRICE_IMPACT VARCHAR(100) ''ENTITLEMENT_PRICE_IMPACT'') ; exec sys.sp_xml_removedocument @H; '")			
				
				else:
					
					SAQIEN_SEL = SqlHelper.GetFirst("sp_executesql @T=N'declare @H int; Declare @val Varchar(MAX);DECLARE @XML XML; SELECT @val = FINAL from(select  REPLACE(entitlement_xml,''<QUOTE_ITEM_ENTITLEMENT>'',sml) AS FINAL FROM (select ''<QUOTE_ITEM_ENTITLEMENT><QUOTE_ID>''+isnull(quote_id,'''')+''</QUOTE_ID><SERVICE_ID>''+isnull(service_id,'''')+''</SERVICE_ID><EQUIPMENT_ID>''+isnull(equipment_id,'''')+''</EQUIPMENT_ID><FABLOCATION_ID>''+isnull(fablocation_id,'''')+''</FABLOCATION_ID><IS_CHANGED>''+isnull(convert(varchar,IS_CHANGED),'''')+''</IS_CHANGED><KB_VERSION>''+isnull(kb_version,'''')+''</KB_VERSION><SALESORG_ID>''+isnull(salesorg_id,'''')+''</SALESORG_ID><SERIAL_NO>''+isnull(serial_no,'''')+''</SERIAL_NO><ENTITLEMENT_GROUP_ID>''+isnull(convert(varchar,entitlement_group_id),'''')+''</ENTITLEMENT_GROUP_ID> <EQUIPMENT_LINE_ID>''+isnull(convert(varchar,EQUIPMENT_LINE_ID),'''')+''</EQUIPMENT_LINE_ID><LINE_ITEM_ID>''+isnull(convert(varchar,LINE_ITEM_ID),'''')+''</LINE_ITEM_ID>'' AS sml,replace(entitlement_xml,''&'','';#38'')  as entitlement_xml from SAQIEN(nolock) where quote_id=''"+str(Qt_ID)+"'' AND cpqtableentryid = "+str(ent_query.cpqtableentryid)+" )A )a SELECT @XML = CONVERT(XML,''<ROOT>''+@VAL+''</ROOT>'') exec sys.sp_xml_preparedocument @H output,@XML; insert "+str(SAQIEN)+" (QUOTE_ID,EQUIPMENT_ID,SERVICE_ID,FABLOCATION_ID,IS_CHANGED,KB_VERSION,SALESORG_ID,SERIAL_NO,ENTITLEMENT_GROUP_ID,EQUIPMENT_LINE_ID,LINE_ITEM_ID,ENTITLEMENT_NAME,ENTITLEMENT_DESCRIPTION,ENTITLEMENT_VALUE_CODE,ENTITLEMENT_DISPLAY_VALUE,ENTITLEMENT_COST_IMPACT,ENTITLEMENT_PRICE_IMPACT) select QUOTE_ID,EQUIPMENT_ID,SERVICE_ID,FABLOCATION_ID,IS_CHANGED,KB_VERSION,SALESORG_ID,SERIAL_NO,ENTITLEMENT_GROUP_ID,EQUIPMENT_LINE_ID,LINE_ITEM_ID,ENTITLEMENT_NAME,ENTITLEMENT_DESCRIPTION,ENTITLEMENT_VALUE_CODE,ENTITLEMENT_DISPLAY_VALUE,ENTITLEMENT_COST_IMPACT,ENTITLEMENT_PRICE_IMPACT  from openxml(@H, ''ROOT/QUOTE_ITEM_ENTITLEMENT'', 0) with (QUOTE_ID VARCHAR(100) ''QUOTE_ID'',EQUIPMENT_ID VARCHAR(100) ''EQUIPMENT_ID'',SERVICE_ID VARCHAR(100) ''SERVICE_ID'',FABLOCATION_ID VARCHAR(100) ''FABLOCATION_ID'',IS_CHANGED VARCHAR(100) ''IS_CHANGED'',KB_VERSION VARCHAR(100) ''KB_VERSION'',SALESORG_ID VARCHAR(100) ''SALESORG_ID'',SERIAL_NO VARCHAR(100) ''SERIAL_NO'',ENTITLEMENT_GROUP_ID VARCHAR(100) ''ENTITLEMENT_GROUP_ID'',EQUIPMENT_LINE_ID VARCHAR(100) ''EQUIPMENT_LINE_ID'',LINE_ITEM_ID VARCHAR(100) ''LINE_ITEM_ID'',ENTITLEMENT_NAME VARCHAR(100) ''ENTITLEMENT_NAME'',ENTITLEMENT_DESCRIPTION VARCHAR(100) ''ENTITLEMENT_DESCRIPTION'',ENTITLEMENT_VALUE_CODE VARCHAR(100) ''ENTITLEMENT_VALUE_CODE'',ENTITLEMENT_DISPLAY_VALUE VARCHAR(100) ''ENTITLEMENT_DISPLAY_VALUE'',ENTITLEMENT_COST_IMPACT VARCHAR(100) ''ENTITLEMENT_COST_IMPACT'',ENTITLEMENT_PRICE_IMPACT VARCHAR(100) ''ENTITLEMENT_PRICE_IMPACT''); exec sys.sp_xml_removedocument @H; '")
					
			
			else:
				Check_flag=0

		if tbl_flag == 1:
			#SAQIEN
			SAQIEN_QUERY = SqlHelper.GetFirst(
					"SELECT CASE WHEN ISNULL(RESULT,'') = '' THEN '' ELSE RESULT END AS RESULT FROM (SELECT replace ('\"SAQIEN\": ['+STUFF((SELECT ','+ JSON FROM (SELECT DISTINCT '{\"ENTITLEMENT_NAME\" : \"'+ENTITLEMENT_NAME+'\",\"ENTITLEMENT_VALUE_CODE\" : \"'+ENTITLEMENT_VALUE_CODE+'\",\"ENTITLEMENT_DISPLAY_VALUE\" : \"'+ENTITLEMENT_DISPLAY_VALUE+'\",\"ENTITLEMENT_COST_IMPACT\" : \"'+ENTITLEMENT_COST_IMPACT+'\",\"ENTITLEMENT_PRICE_IMPACT\" : \"'+ENTITLEMENT_PRICE_IMPACT+'\",\"ENTITLEMENT_DESCRIPTION\" : \"'+ENTITLEMENT_DESCRIPTION+'\",\"EQUIPMENT_ID\" : \"'+EQUIPMENT_ID+'\",\"FABLOCATION_ID\" : \"'+FABLOCATION_ID+'\",\"IS_CHANGED\" : \"'+IS_CHANGED+'\",\"KB_VERSION\" : \"'+KB_VERSION+'\",\"QUOTE_ID\" : \"'+QUOTE_ID+'\",\"SALESORG_ID\" : \"'+SALESORG_ID+'\",\"SERIAL_NO\" : \"'+SERIAL_NO+'\",\"SERVICE_ID\" : \"'+SERVICE_ID+'\",\"ENTITLEMENT_GROUP_ID\" : \"'+ENTITLEMENT_GROUP_ID+'\",	\"EQUIPMENT_LINE_ID\" : \"'+EQUIPMENT_LINE_ID+'\",\"LINE_ITEM_ID\" : \"'+LINE_ITEM_ID+'\",\"QTEREV_ID\" : \"'+QTEREV_ID+'\"}' AS JSON from (SELECT DISTINCT  ISNULL(SAQIEN_INBOUND.ENTITLEMENT_NAME,'') AS ENTITLEMENT_NAME,ISNULL(SAQIEN_INBOUND.ENTITLEMENT_VALUE_CODE,'') AS	ENTITLEMENT_VALUE_CODE,ISNULL(SAQIEN_INBOUND.ENTITLEMENT_DISPLAY_VALUE,'')	AS	ENTITLEMENT_DISPLAY_VALUE,ISNULL(SAQIEN_INBOUND.ENTITLEMENT_COST_IMPACT,'') AS ENTITLEMENT_COST_IMPACT,ISNULL(SAQIEN_INBOUND.ENTITLEMENT_PRICE_IMPACT,'') AS	ENTITLEMENT_PRICE_IMPACT,ISNULL(SAQIEN_INBOUND.ENTITLEMENT_DESCRIPTION,'')	AS ENTITLEMENT_DESCRIPTION,ISNULL(SAQIEN_INBOUND.EQUIPMENT_ID,'') AS	EQUIPMENT_ID,ISNULL(SAQIEN_INBOUND.FABLOCATION_ID,'') AS FABLOCATION_ID,ISNULL(SAQIEN_INBOUND.IS_CHANGED,'')  AS IS_CHANGED,ISNULL(SAQIEN_INBOUND.KB_VERSION,'') AS KB_VERSION,ISNULL(SAQIEN_INBOUND.QUOTE_ID,'') AS QUOTE_ID,ISNULL(SAQIEN_INBOUND.SALESORG_ID,'') AS SALESORG_ID,ISNULL(SAQIEN_INBOUND.SERIAL_NO,'') AS	SERIAL_NO,ISNULL(SAQIEN_INBOUND.SERVICE_ID,'') AS SERVICE_ID,ISNULL(SAQIEN_INBOUND.ENTITLEMENT_GROUP_ID,'')	AS	ENTITLEMENT_GROUP_ID,ISNULL(SAQIEN_INBOUND.EQUIPMENT_LINE_ID,'') AS EQUIPMENT_LINE_ID,ISNULL(SAQIEN_INBOUND.LINE_ITEM_ID,'') AS LINE_ITEM_ID,ISNULL(SAQIEN.QTEREV_ID,'') AS	QTEREV_ID FROM SAQIEN_INBOUND(NOLOCK) join SAQIEN(NOLOCK) ON SAQIEN_INBOUND.QUOTE_ID = SAQIEN.QUOTE_ID WHERE SAQIEN_INBOUND.QUOTE_ID = '"+str(Qt_ID)+"' AND SAQIEN.QTEREV_ID = '"+str(Revision_ID)+"' ) t 	) A FOR XML PATH ('')  ), 1, 1, '')+']','amp;#','#') AS RESULT)A ")

		Table_Name = 'SAQIEN_INBOUND'
			
		TempTable = SqlHelper.GetFirst("sp_executesql @T=N'IF EXISTS (SELECT ''X'' FROM SYS.OBJECTS WHERE NAME= ''"+str(Table_Name)+"'' ) BEGIN DROP TABLE "+str(Table_Name)+" END'")

		final_json = ''
		if SAQTMT_QUERY.RESULT != '':
			final_json = SAQTMT_QUERY.RESULT+','
		if SAQTRV_QUERY.RESULT != '':
			final_json = final_json+SAQTRV_QUERY.RESULT+','
		if SAQTIP_QUERY.RESULT != '':
			final_json = final_json+SAQTIP_QUERY.RESULT+','
		if SAQTBP_QUERY.RESULT != '':
			final_json = final_json+SAQTBP_QUERY.RESULT+','
		if SAQDOC_QUERY.RESULT != '':
			final_json = final_json+SAQDOC_QUERY.RESULT+','
		if SAQITM_QUERY.RESULT != '':
			final_json = final_json+SAQITM_QUERY.RESULT+','
		if SAQICO_QUERY.RESULT != '':
			final_json = final_json+SAQICO_QUERY.RESULT+','
		if SAQICA_QUERY.RESULT != '':
			final_json = final_json+SAQICA_QUERY.RESULT+','
		if SAQAPP_QUERY.RESULT != '':
			final_json = final_json+SAQAPP_QUERY.RESULT+','
		if SAQIFP_QUERY.RESULT != '':
			final_json = final_json+SAQIFP_QUERY.RESULT+','
		if SAQIBP_QUERY.RESULT != '':
			final_json = final_json+SAQIBP_QUERY.RESULT+','
		"""if str(SAQSCV_QUERY.RESULT) != '':
			final_json = final_json+str(SAQSCV_QUERY.RESULT)+','
		if str(SAQTFV_QUERY.RESULT) != '':
			final_json = final_json+str(SAQTFV_QUERY.RESULT)+','
		"""
		if tbl_flag == 1:
			if SAQIEN_QUERY.RESULT != '':
				final_json = final_json+SAQIEN_QUERY.RESULT+','
			
		Final_json = '{"CPQ_Columns": {'+final_json[:-1]+'}}'
		Log.Info("45678 Qt_ID------>"+str(Qt_ID))
		Final_json = Final_json.replace("'",'&&&&')
		if len(Final_json)>0:
			LOGIN_CRE = SqlHelper.GetFirst("SELECT  URL FROM SYCONF where EXTERNAL_TABLE_NAME ='CPQ_TO_HADOOP'")
			Oauth_info = SqlHelper.GetFirst("SELECT  DOMAIN,URL FROM SYCONF where EXTERNAL_TABLE_NAME ='OAUTH'")

			requestdata =Oauth_info.DOMAIN
			webclient = System.Net.WebClient()
			webclient.Headers[System.Net.HttpRequestHeader.ContentType] = "application/x-www-form-urlencoded"
			response = webclient.UploadString(Oauth_info.URL,str(requestdata))

			response = eval(response)
			access_token = response['access_token']

			authorization = "Bearer " + access_token
			webclient = System.Net.WebClient()
			webclient.Headers[System.Net.HttpRequestHeader.ContentType] = "application/json"
			webclient.Headers[System.Net.HttpRequestHeader.Authorization] = authorization;


			#primaryQueryItems = SqlHelper.GetFirst( ""+ str(Parameter.QUERY_CRITERIA_1)+ " SYINPL (INTEGRATION_PAYLOAD,INTEGRATION_NAME )  select ''"+Final_json+ "'',''Hadoop_test2'' ' ")	

			Hadoop_response = webclient.UploadString(str(LOGIN_CRE.URL),Final_json)	
			#Log.Info("789 Hadoop_response --->"+str(Hadoop_response))
			
			if "True" in Hadoop_response: 
				StatusUpdateQuery = SqlHelper.GetFirst(""+ str(Parameter1.QUERY_CRITERIA_1)+ "  A SET HADOOP_FLAG = ''True'' FROM SAQTMT(NOLOCK) A WHERE QUOTE_ID=''"+str(data.Quote_id)+"''  '")

				ApiResponse = ApiResponseFactory.JsonResponse(Hadoop_response)
			
			else:
				ApiResponse = ApiResponseFactory.JsonResponse(Hadoop_response)
		else:
			ApiResponse = ApiResponseFactory.JsonResponse({"Response": [{"Status": "200", "Message": "Data not available"}]})

except:
	Table_Name = 'SAQIEN_INBOUND'
			
	TempTable = SqlHelper.GetFirst("sp_executesql @T=N'IF EXISTS (SELECT ''X'' FROM SYS.OBJECTS WHERE NAME= ''"+str(Table_Name)+"'' ) BEGIN DROP TABLE "+str(Table_Name)+" END'")
	Log.Info("QTPOSTCQHD ERROR---->:" + str(sys.exc_info()[1]))
	Log.Info("QTPOSTCQHD ERROR LINE NO---->:" + str(sys.exc_info()[-1].tb_lineno))
	ApiResponse = ApiResponseFactory.JsonResponse({"Response": [{"Status": "400", "Message": str(sys.exc_info()[1])}]})